{"version":3,"sources":["../../../node_modules/.pnpm/@rgba-image+copy@0.1.3/node_modules/@rgba-image/copy/src/index.ts","../../../node_modules/.pnpm/@rgba-image+create-image@0.1.1/node_modules/@rgba-image/create-image/src/index.ts","../../../node_modules/.pnpm/@rgba-image+lanczos@0.1.1/node_modules/@rgba-image/lanczos/src/filters.ts","../../../node_modules/.pnpm/@rgba-image+lanczos@0.1.1/node_modules/@rgba-image/lanczos/src/convolve.ts","../../../node_modules/.pnpm/@rgba-image+lanczos@0.1.1/node_modules/@rgba-image/lanczos/src/index.ts","../../../node_modules/.pnpm/browser-image-hash@0.0.5/node_modules/browser-image-hash/dist/HashableImageSourceConverter/DifferenceHash/VanilaConverter.js","../../../node_modules/.pnpm/browser-image-hash@0.0.5/node_modules/browser-image-hash/dist/HashSource.js","../../../node_modules/.pnpm/browser-image-hash@0.0.5/node_modules/browser-image-hash/dist/HashableImageSourceConverter/Resizer/LanczosResizer.js","../../../node_modules/.pnpm/browser-image-hash@0.0.5/node_modules/browser-image-hash/dist/Hash.js","../../../node_modules/.pnpm/browser-image-hash@0.0.5/node_modules/browser-image-hash/dist/HashGenerator.js","../../../node_modules/.pnpm/browser-image-hash@0.0.5/node_modules/browser-image-hash/dist/HashableImageSourceConverter/GlayScaleCalculator/ITU_R601_2Method.js","../../../node_modules/.pnpm/browser-image-hash@0.0.5/node_modules/browser-image-hash/dist/DifferenceHashBuilder.js","../src/common/dotlottie-state-machine-common.ts","../src/common/dotlottie-state.ts","../src/common/manifest.ts","../src/common/utils.ts","../src/common/lottie-image-common.ts","../src/common/dotlottie-plugin.ts","../src/lottie-image.ts","../src/common/duplicate-image-detector-common.ts","../src/duplicate-image-detector.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEO,QAAM,OAAqB,CAChC,QAAmB,MACnB,KAAK,GAAG,KAAK,GAAG,KAAK,OAAO,QAAQ,IAAI,KAAK,OAAO,SAAS,IAC7D,KAAK,GAAG,KAAK,MACX;AACF,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AAEV,UAAI,MAAM,KAAK,MAAM;AAAI;AAEzB,YAAM,aAAa,IAAI,YAAa,OAAO,KAAK,MAAM;AACtD,YAAM,WAAW,IAAI,YAAa,KAAK,KAAK,MAAM;AAElD,eAAU,IAAI,GAAG,IAAI,IAAI,KAAM;AAC7B,cAAM,UAAU,KAAK;AAErB,YAAI,UAAU,KAAK,WAAW,OAAO;AAAS;AAE9C,cAAM,QAAQ,KAAK;AAEnB,YAAI,QAAQ,KAAK,SAAS,KAAK;AAAS;AAExC,iBAAU,IAAI,GAAG,IAAI,IAAI,KAAM;AAC7B,gBAAM,UAAU,KAAK;AAErB,cAAI,UAAU,KAAK,WAAW,OAAO;AAAQ;AAE7C,gBAAM,QAAQ,KAAK;AAEnB,cAAK,QAAQ,KAAK,SAAS,KAAK;AAAQ;AAExC,gBAAM,cAAc,UAAU,OAAO,QAAQ;AAC7C,gBAAM,YAAY,QAAQ,KAAK,QAAQ;AAEvC,mBAAU,aAAc,WAAY;;;IAG1C;AAzCa,YAAA,OAAI;;;;;;;;;ACAJ,YAAA,qBAAqB,CAAE,OAAqC,CAAE,GAAG,GAAG,GAAG,CAAC,GAAI,WAAW,MAAM;AACxG,iBAAW,KAAK,MAAO,QAAQ;AAE/B,UAAI,MAAO,QAAQ,KAAM,WAAW,GAAG;AACrC,cAAM,UAAW,+CAA+C;;AAGlE,UAAK,CAAG,aAAY,SAAU,KAAK,SAAS,UAAU;AACpD,cAAM,UAAW,yCAA0C,kBAAmB;;AAGhF,aAAS,IAAI,kBAAmB,IAAI,EAAK,MAAO,GAAG,QAAQ;AAE3D,YAAM,UAAU,KAAK,MAAO,OAAK,MAAM,CAAC;AAExC,YAAM,cAA2B,CAAE,OAAe,QAAgB,SAA6B;AAC7F,YAAK,UAAU,UAAa,WAAW,QAAY;AACjD,gBAAM,UAAW,sBAAsB;;AAGzC,gBAAQ,KAAK,MAAO,KAAK;AACzB,iBAAS,KAAK,MAAO,MAAM;AAE3B,YAAK,MAAO,KAAK,KAAM,QAAQ,KAAK,MAAO,MAAM,KAAM,SAAS,GAAI;AAClE,gBAAM,UAAW,8DAA8D;;AAGjF,cAAM,SAAS,QAAQ,SAAS;AAEhC,YAAK,SAAS,QAAY;AACxB,iBAAO,IAAI,kBAAmB,MAAM;;AAGtC,YAAK,gBAAgB,mBAAoB;AACvC,cAAK,KAAK,WAAW,QAAS;AAC5B,kBAAM,UAAW,8DAA8D;;AAGjF,cAAK,CAAC,SAAU;AACd,qBAAU,IAAI,GAAG,IAAI,QAAQ,KAAM;AACjC,uBAAU,IAAI,GAAG,IAAI,OAAO,KAAM;AAChC,sBAAM,QAAU,KAAI,QAAQ,KAAM;AAElC,yBAAU,IAAI,GAAG,IAAI,UAAU,KAAM;AACnC,uBAAM,QAAQ,KAAM,KAAM;;;;;AAMlC,iBAAkB;YAChB,IAAI,QAAK;AAAK,qBAAO;YAAM;YAC3B,IAAI,SAAM;AAAK,qBAAO;YAAO;YAC7B,IAAI,OAAI;AAAK,qBAAO;YAAK;;;AAI7B,cAAM,UAAW,oDAAoD;MACvE;AAEA,aAAO;IACT;AAEa,YAAA,cAAc,QAAA,mBAAkB;;;;;;;;;;ACjE7C,QAAM,gBAAgB;AAEtB,QAAM,cAAc,CAAE,GAAW,MAAa;AAC5C,UAAK,KAAK,CAAC,KAAK,KAAK;AAAI,eAAO;AAChC,UAAK,KAAK;AAAI,eAAO;AAKrB,YAAM,MAAM,IAAI,KAAK;AAErB,aAAS,KAAK,IAAK,GAAG,IAAK,MAAQ,KAAK,IAAK,MAAM,CAAC,IAAO,OAAM;IACnE;AAEA,QAAM,eAAe,CAAE,UACrB,KAAK,MAAO,QAAY,OAAK,iBAAkB,EAAG;AAE7C,QAAM,UAAU,CACrB,SAAiB,UACjB,OAAe,QACf,SACE;AACF,YAAM,IAAI,OAAO,IAAI;AACrB,YAAM,gBAAgB,IAAI;AAC1B,YAAM,eAAe,KAAK,IAAK,GAAG,KAAK;AAGvC,YAAM,YAAY,IAAI;AAEtB,YAAM,uBAAuB,KAAK,MAAS,aAAY,KAAM,CAAC;AAC9D,YAAM,eAAe,IAAI,WAAc,wBAAuB,KAAM,QAAQ;AAE5E,UAAI,kBAAkB;AAGtB,eAAU,YAAY,GAAG,YAAY,UAAU,aAAc;AAG3D,cAAM,cAAgB,aAAY,OAAQ,gBAAgB;AAC1D,cAAM,cAAc,KAAK,IAAK,GAAG,KAAK,MAAO,cAAc,SAAS,CAAE;AACtE,cAAM,aAAa,KAAK,IAAK,UAAU,GAAG,KAAK,KAAM,cAAc,SAAS,CAAE;AAE9E,cAAM,oBAAoB,aAAa,cAAc;AACrD,cAAM,cAAc,IAAI,aAAc,iBAAiB;AACvD,cAAM,YAAY,IAAI,WAAY,iBAAiB;AAEnD,YAAI,QAAQ;AAGZ,YAAI,QAAQ;AACZ,iBAAU,QAAQ,aAAa,SAAS,YAAY,SAAU;AAC5D,gBAAM,aAAa,YAAiB,SAAQ,MAAQ,eAAgB,cAAc,CAAC;AAEnF,mBAAS;AACT,sBAAa,SAAU;AAEvB;;AAIF,YAAI,cAAc;AAElB,iBAAU,SAAQ,GAAG,SAAQ,YAAY,QAAQ,UAAU;AACzD,gBAAM,eAAc,YAAa,UAAU;AAE3C,yBAAe;AACf,oBAAW,UAAU,aAAc,YAAW;;AAIhD,kBAAW,YAAY,MAAO,aAAc,IAAI,WAAW;AAU3D,YAAI,eAAe;AACnB,eAAQ,eAAe,UAAU,UAAU,UAAW,kBAAmB,GAAI;AAC3E;;AAGF,YAAI,gBAAgB,UAAU,SAAS;AACvC,eAAQ,gBAAgB,KAAK,UAAW,mBAAoB,GAAI;AAC9D;;AAGF,cAAM,cAAc,cAAc;AAClC,cAAM,aAAa,gBAAgB,eAAe;AAElD,qBAAc,qBAAsB;AACpC,qBAAc,qBAAsB;AAEpC,qBAAa,IAAK,UAAU,SAAU,cAAc,gBAAgB,CAAC,GAAI,eAAe;AACxF,2BAAmB;;AAGrB,aAAO;IACT;AApFa,YAAA,UAAO;;;;;;;;;;ACjBpB,QAAM,gBAAgB;AAEf,QAAM,WAAW,CACtB,QAA2B,MAC3B,IAAY,IAAY,IACxB,YACE;AACF,UAAI,YAAY;AAChB,UAAI,aAAa;AAGjB,eAAU,UAAU,GAAG,UAAU,IAAI,WAAY;AAC/C,YAAI,YAAY;AAGhB,iBAAU,QAAQ,GAAG,QAAQ,IAAI,SAAU;AAEzC,gBAAM,cAAc,QAAS;AAE7B,cAAI,SAAW,YAAc,cAAc,IAAQ;AAEnD,cAAI,IAAI;AACR,cAAI,IAAI;AACR,cAAI,IAAI;AACR,cAAI,IAAI;AAGR,mBACM,aAAa,QAAS,cAAe,aAAa,GAAG,cACzD;AACA,kBAAM,cAAc,QAAS;AAE7B,gBAAM,IAAI,cAAc,OAAQ,UAAa;AAC7C,gBAAM,IAAI,cAAc,OAAQ,SAAS,KAAQ;AACjD,gBAAM,IAAI,cAAc,OAAQ,SAAS,KAAQ;AACjD,gBAAM,IAAI,cAAc,OAAQ,SAAS,KAAQ;AAEjD,qBAAW,SAAS,IAAM;;AAU5B,eAAM,cAAiB,IAAM,MAAK,OAAU;AAC5C,eAAM,aAAa,KAAQ,IAAM,MAAK,OAAU;AAChD,eAAM,aAAa,KAAQ,IAAM,MAAK,OAAU;AAChD,eAAM,aAAa,KAAQ,IAAM,MAAK,OAAU;AAEhD,uBAAe,aAAa,KAAK,IAAM;;AAGzC,qBAAiB,WAAU,KAAM,IAAM;AACvC,oBAAgB,WAAU,KAAM,KAAK,IAAM;;IAE/C;AAxDa,YAAA,WAAQ;;;;;;;;;;ACDrB,QAAA,SAAA;AACA,QAAA,iBAAA;AACA,QAAA,YAAA;AACA,QAAA,aAAA;AAEA,QAAM,SAAS,CAAE,QAAmB,MAAiB,OAAO,UAAU;AACpE,YAAM,SAAS,KAAK,QAAQ,OAAO;AACnC,YAAM,SAAS,KAAK,SAAS,OAAO;AAEpC,YAAM,WAAW,UAAA,QAAS,OAAO,OAAO,KAAK,OAAO,QAAQ,GAAG,IAAI;AACnE,YAAM,WAAW,UAAA,QAAS,OAAO,QAAQ,KAAK,QAAQ,QAAQ,GAAG,IAAI;AAErE,YAAM,MAAM,IAAI,kBAAmB,KAAK,QAAQ,OAAO,SAAS,CAAC;AAEjE,iBAAA,SAAU,OAAO,MAAM,KAAK,OAAO,OAAO,OAAO,QAAQ,KAAK,OAAO,QAAQ;AAC7E,iBAAA,SAAU,KAAK,KAAK,MAAM,OAAO,QAAQ,KAAK,OAAO,KAAK,QAAQ,QAAQ;IAC5E;AAEO,QAAM,WAAwB,CAAE,QAAmB,MAAiB,KAAK,GAAG,KAAK,GAAG,KAAK,OAAO,QAAQ,IAAI,KAAK,OAAO,SAAS,IAAI,KAAK,GAAG,KAAK,GAAG,KAAK,KAAK,QAAQ,IAAI,KAAK,KAAK,SAAS,OAAO;AAC1M,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AAEV,UAAK,MAAM,KAAK,MAAM,KAAK,MAAM,KAAK,MAAM;AAAI;AAEhD,UAAI,OAAO,KAAK,OAAO,KAAK,OAAO,OAAO,SAAS,OAAO,OAAO,UAAU,OAAO,KAAK,OAAO,KAAK,OAAO,KAAK,SAAS,OAAO,KAAK,QAAQ;AAC1I,eAAQ,QAAQ,IAAI;AAEpB;;AAUF,YAAM,gBAAgB,eAAA,YAAa,IAAI,EAAE;AACzC,YAAM,cAAc,eAAA,YAAa,IAAI,EAAE;AACvC,aAAA,KAAM,QAAQ,eAAe,IAAI,EAAE;AACnC,aAAQ,eAAe,WAAW;AAClC,aAAA,KAAM,aAAa,MAAM,GAAG,GAAG,YAAY,OAAO,YAAY,QAAQ,IAAI,EAAE;IAC9E;AA9Ba,YAAA,UAAO;AAgCb,QAAM,YAAyB,CAAE,QAAmB,MAAiB,KAAK,GAAG,KAAK,GAAG,KAAK,OAAO,QAAQ,IAAI,KAAK,OAAO,SAAS,IAAI,KAAK,GAAG,KAAK,GAAG,KAAK,KAAK,QAAQ,IAAI,KAAK,KAAK,SAAS,OAAO;AAC3M,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AAEV,UAAK,MAAM,KAAK,MAAM,KAAK,MAAM,KAAK,MAAM;AAAI;AAEhD,UAAK,OAAO,KAAK,OAAO,KAAK,OAAO,OAAO,SAAS,OAAO,OAAO,UAAU,OAAO,KAAK,OAAO,KAAK,OAAO,KAAK,SAAS,OAAO,KAAK,QAAS;AAC5I,eAAQ,QAAQ,MAAM,IAAI;AAE1B;;AAUF,YAAM,gBAAgB,eAAA,YAAa,IAAI,EAAE;AACzC,YAAM,cAAc,eAAA,YAAa,IAAI,EAAE;AACvC,aAAA,KAAM,QAAQ,eAAe,IAAI,EAAE;AACnC,aAAQ,eAAe,aAAa,IAAI;AACxC,aAAA,KAAM,aAAa,MAAM,GAAG,GAAG,YAAY,OAAO,YAAY,QAAQ,IAAI,EAAE;IAC9E;AA9Ba,YAAA,WAAQ;;;;;ACnDrB,IAAI,SAAkC,SAAU,GAAG,GAAG;AAClD,MAAI,IAAI,OAAO,WAAW,cAAc,EAAE,OAAO;AACjD,MAAI,CAAC;AAAG,WAAO;AACf,MAAI,IAAI,EAAE,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,GAAG;AAC/B,MAAI;AACA,WAAQ,OAAM,UAAU,MAAM,MAAM,CAAE,KAAI,EAAE,KAAK,GAAG;AAAM,SAAG,KAAK,EAAE,KAAK;AAAA,EAC7E,SACO,OAAP;AAAgB,QAAI,EAAE,MAAa;AAAA,EAAG,UACtC;AACI,QAAI;AACA,UAAI,KAAK,CAAC,EAAE,QAAS,KAAI,EAAE;AAAY,UAAE,KAAK,CAAC;AAAA,IACnD,UACA;AAAU,UAAI;AAAG,cAAM,EAAE;AAAA,IAAO;AAAA,EACpC;AACA,SAAO;AACX;AACA,IAAI,gBAAgD,SAAU,IAAI,MAAM;AACpE,WAAS,IAAI,GAAG,KAAK,KAAK,QAAQ,IAAI,GAAG,QAAQ,IAAI,IAAI,KAAK;AAC1D,OAAG,KAAK,KAAK;AACjB,SAAO;AACX;AACA,IAAI,kBAAiC,WAAY;AAC7C,4BAAyB,UAAU,qBAAqB,SAAS;AAC7D,SAAK,WAAW;AAChB,SAAK,sBAAsB;AAC3B,SAAK,UAAU;AAAA,EACnB;AACA,mBAAgB,UAAU,iCAAiC,SAAU,OAAO,QAAQ;AAChF,QAAI,SAAS,KAAK,SAAS,cAAc,QAAQ;AACjD,WAAO,QAAQ;AACf,WAAO,SAAS;AAChB,WAAO,aAAa,SAAS,2EAA2E;AACxG,QAAI,MAAM,OAAO,WAAW,IAAI;AAChC,QAAI,QAAQ,MAAM;AACd,YAAM,IAAI,eAAe,oCAAoC;AAAA,IACjE;AACA,QAAI,2BAA2B;AAC/B,QAAI,8BAA8B;AAClC,QAAI,0BAA0B;AAC9B,QAAI,wBAAwB;AAC5B,WAAO;AAAA,EACX;AACA,mBAAgB,UAAU,UAAU,SAAU,QAAQ;AAClD,QAAI,QAAQ;AACZ,QAAI,MAAM,IAAI,MAAM;AACpB,QAAI,SAAU,IAAI,QAAQ,SAAU,SAAS;AACzC,UAAI,SAAS,WAAY;AACrB,YAAI,MAAM,MAAM,+BAA+B,IAAI,OAAO,IAAI,MAAM;AACpE,YAAI,UAAU,KAAK,GAAG,GAAG,IAAI,OAAO,IAAI,MAAM;AAC9C,YAAI,WAAW,IAAI,aAAa,GAAG,GAAG,IAAI,OAAO,IAAI,MAAM,EAAE;AAC7D,gBAAQ,QAAQ;AAAA,MACpB;AAAA,IACJ,CAAC,EACI,KAAK,SAAU,UAAU;AAC1B,aAAO,MAAM,QAAQ,OAAO,UAAU,IAAI,OAAO,IAAI,QAAQ,OAAO,OAAO,OAAO,MAAM;AAAA,IAC5F,CAAC,EAAE,KAAK,SAAU,iBAAiB;AAC/B,UAAI,iBAAiB,cAAc,CAAC,GAAG,OAAO,MAAM,gBAAgB,SAAS,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,IAAI,SAAU,GAAG;AACtG,YAAI,QAAQ,IAAI;AAChB,YAAI,KAAK,OAAO;AAAA,UACZ,gBAAgB;AAAA,UAChB,gBAAgB,QAAQ;AAAA,UACxB,gBAAgB,QAAQ;AAAA,QAC5B,GAAG,CAAC,GAAG,IAAI,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,GAAG;AACpC,eAAO,MAAM,oBAAoB,GAAG,GAAG,CAAC;AAAA,MAC5C,CAAC;AACD,aAAO,IAAI,kBAAkB,cAAc;AAAA,IAC/C,CAAC;AACD,QAAI,MAAM,OAAO,IAAI,SAAS;AAC9B,WAAO;AAAA,EACX;AACA,SAAO;AACX,EAAE;AACF,IAAO,0BAAQ;;;ACxEf,IAAI,aAA4B,WAAY;AACxC,uBAAoB,KAAK,UAAU;AAC/B,QAAI,aAAa,QAAQ;AAAE,iBAAW;AAAA,IAAG;AACzC,SAAK,MAAM;AACX,SAAK,WAAW;AAChB,SAAK,QAAQ,WAAW;AACxB,SAAK,SAAS;AAAA,EAClB;AACA,cAAW,UAAU,gBAAgB,WAAY;AAC7C,WAAO,KAAK,QAAQ,KAAK;AAAA,EAC7B;AACA,SAAO;AACX,EAAE;AACF,IAAO,qBAAQ;;;ACbf,qBAAwB;AACxB,IAAI,iBAAgC,WAAY;AAC5C,6BAA0B;AAAA,EAC1B;AACA,kBAAe,UAAU,SAAS,SAAU,QAAQ,aAAa,cAAc,eAAe,gBAAgB;AAC1G,QAAI,kBAAmB,IAAI,eAAe,aAAa,cAAc,MAAM;AAC3E,QAAI,gBAAiB,IAAI,eAAe,eAAe,gBAAgB,IAAI,kBAAkB,gBAAgB,iBAAiB,CAAC,CAAC;AAChI,gCAAQ,iBAAiB,aAAa;AACtC,WAAO,cAAc;AAAA,EACzB;AACA,SAAO;AACX,EAAE;AACF,IAAO,yBAAQ;AACf,IAAI,iBAAgC,WAAY;AAC5C,2BAAwB,OAAO,QAAQ,QAAQ;AAC3C,SAAK,QAAQ;AACb,SAAK,SAAS;AACd,SAAK,OAAO;AAAA,EAChB;AACA,SAAO;AACX,EAAE;;;ACpBF,IAAI,UAAkC,SAAU,GAAG,GAAG;AAClD,MAAI,IAAI,OAAO,WAAW,cAAc,EAAE,OAAO;AACjD,MAAI,CAAC;AAAG,WAAO;AACf,MAAI,IAAI,EAAE,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,GAAG;AAC/B,MAAI;AACA,WAAQ,OAAM,UAAU,MAAM,MAAM,CAAE,KAAI,EAAE,KAAK,GAAG;AAAM,SAAG,KAAK,EAAE,KAAK;AAAA,EAC7E,SACO,OAAP;AAAgB,QAAI,EAAE,MAAa;AAAA,EAAG,UACtC;AACI,QAAI;AACA,UAAI,KAAK,CAAC,EAAE,QAAS,KAAI,EAAE;AAAY,UAAE,KAAK,CAAC;AAAA,IACnD,UACA;AAAU,UAAI;AAAG,cAAM,EAAE;AAAA,IAAO;AAAA,EACpC;AACA,SAAO;AACX;AACA,IAAI,iBAAgD,SAAU,IAAI,MAAM;AACpE,WAAS,IAAI,GAAG,KAAK,KAAK,QAAQ,IAAI,GAAG,QAAQ,IAAI,IAAI,KAAK;AAC1D,OAAG,KAAK,KAAK;AACjB,SAAO;AACX;AACA,IAAI,OAAsB,WAAY;AAClC,iBAAc,SAAS;AACnB,QAAI,QAAQ,MAAM,EAAE,EAAE,KAAK,SAAU,KAAK;AAAE,aAAQ,QAAQ,OAAO,QAAQ;AAAA,IAAM,CAAC,GAAG;AACjF,YAAM,IAAI,UAAU,WAAW;AAAA,IACnC;AACA,SAAK,UAAU;AAAA,EACnB;AACA,QAAK,UAAU,qBAAqB,SAAU,MAAM;AAChD,QAAI,KAAK,QAAQ,WAAW,KAAK,QAAQ,QAAQ;AAC7C,YAAM,IAAI,UAAU,2BAA2B;AAAA,IACnD;AACA,QAAI,SAAS,KAAK,QAAQ,MAAM,EAAE;AAClC,QAAI,OAAO,KAAK,QAAQ,MAAM,EAAE,EAAE,OAAO,SAAU,KAAK,OAAO;AAAE,aAAO,QAAS,QAAO,UAAU;AAAA,IAAM,CAAC;AACzG,WAAO,KAAK;AAAA,EAChB;AACA,QAAK,UAAU,WAAW,WAAY;AAClC,WAAO,KAAK,oBAAoB,KAAK,QAAQ,MAAM,EAAE,EAAE,IAAI,SAAU,KAAK;AAAE,aAAQ,QAAQ,MAAO,IAAI;AAAA,IAAG,CAAC,CAAC;AAAA,EAChH;AACA,QAAK,UAAU,aAAa,SAAU,QAAO,OAAO;AAChD,WAAO,eAAc,CAAC,GAAG,QAAO,MAAM,KAAK,KAAK,OAAM,SAAS,KAAK,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,IAAI,SAAU,OAAO;AAAE,aAAO,OAAM,MAAM,QAAQ,OAAQ,QAAQ,QAAS,KAAK;AAAA,IAAG,CAAC;AAAA,EACxK;AACA,QAAK,UAAU,sBAAsB,SAAU,eAAe;AAC1D,WAAO,KAAK,WAAW,eAAe,CAAC,EAClC,IAAI,SAAU,KAAK;AAAE,aAAO,SAAS,IAAI,KAAK,EAAE,GAAG,CAAC,EAAE,SAAS,EAAE;AAAA,IAAG,CAAC,EAAE,KAAK,EAAE;AAAA,EACvF;AACA,SAAO;AACX,EAAE;AACF,IAAO,eAAQ;;;AChDf,IAAI,UAAkC,SAAU,GAAG,GAAG;AAClD,MAAI,IAAI,OAAO,WAAW,cAAc,EAAE,OAAO;AACjD,MAAI,CAAC;AAAG,WAAO;AACf,MAAI,IAAI,EAAE,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,GAAG;AAC/B,MAAI;AACA,WAAQ,OAAM,UAAU,MAAM,MAAM,CAAE,KAAI,EAAE,KAAK,GAAG;AAAM,SAAG,KAAK,EAAE,KAAK;AAAA,EAC7E,SACO,OAAP;AAAgB,QAAI,EAAE,MAAa;AAAA,EAAG,UACtC;AACI,QAAI;AACA,UAAI,KAAK,CAAC,EAAE,QAAS,KAAI,EAAE;AAAY,UAAE,KAAK,CAAC;AAAA,IACnD,UACA;AAAU,UAAI;AAAG,cAAM,EAAE;AAAA,IAAO;AAAA,EACpC;AACA,SAAO;AACX;AACA,IAAI,iBAAgD,SAAU,IAAI,MAAM;AACpE,WAAS,IAAI,GAAG,KAAK,KAAK,QAAQ,IAAI,GAAG,QAAQ,IAAI,IAAI,KAAK;AAC1D,OAAG,KAAK,KAAK;AACjB,SAAO;AACX;AAEA,IAAI,gBAA+B,WAAY;AAC3C,0BAAuB,UAAU;AAC7B,SAAK,WAAW;AAAA,EACpB;AACA,iBAAc,UAAU,kBAAkB,SAAU,QAAQ,WAAW;AACnE,cAAU,QAAQ,OAAO;AACzB,cAAU,SAAS,OAAO;AAC1B,QAAI,SAAS,KAAK,SAAS,cAAc,QAAQ;AACjD,QAAI,UAAU,OAAO,WAAW,IAAI;AACpC,QAAI,YAAY,MAAM;AAClB,YAAM,IAAI,eAAe,oCAAoC;AAAA,IACjE;AACA,YAAQ,UAAU,WAAW,GAAG,GAAG,OAAO,OAAO,OAAO,MAAM;AAC9D,WAAO,KAAK,SAAS,QAAQ,OAAO;AAAA,EACxC;AACA,iBAAc,UAAU,qCAAqC,SAAU,QAAQ,+BAA+B;AAC1G,QAAI,YAAY,8BAA8B,aAAa,GAAG,GAAG,OAAO,OAAO,OAAO,MAAM,EAAE;AAC9F,QAAI,YAAY,IAAI,kBAAkB,eAAc,CAAC,GAAG,QAAO,MAAM,UAAU,SAAS,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,IAAI,SAAU,GAAG;AACjH,UAAI,QAAQ,IAAI;AAChB,aAAO,UAAU;AAAA,IACrB,CAAC,CAAC;AACF,WAAO,KAAK,SAAS,QAAQ,SAAS;AAAA,EAC1C;AACA,iBAAc,UAAU,8BAA8B,SAAU,QAAQ,WAAW;AAC/E,QAAI,UAAU,WAAW,OAAO,cAAc,GAAG;AAC7C,YAAM,IAAI,MAAM,gEAAgE,OAAO,cAAc,CAAC;AAAA,IAC1G;AACA,QAAI,gBAAgB,MAAM,KAAK,SAAS,EACnC,IAAI,SAAU,KAAK,OAAO,QAAQ;AAAE,aAAS,OAAO,OAAO,QAAQ,KAAM,IAAI;AAAA,IAAI,CAAC,EAClF,OAAO,SAAU,GAAG,OAAO;AAAE,aAAQ,SAAQ,KAAK,OAAO,UAAU;AAAA,IAAG,CAAC,EAAE,KAAK,EAAE;AACrF,WAAO,IAAI,aAAK,aAAa;AAAA,EACjC;AACA,iBAAc,UAAU,WAAW,SAAU,QAAQ,iBAAiB;AAClE,QAAI,2BAA2B,kBAAkB;AAC7C,aAAO,KAAK,gBAAgB,QAAQ,eAAe;AAAA,IACvD,WACS,2BAA2B,0BAA0B;AAC1D,aAAO,KAAK,mCAAmC,QAAQ,eAAe;AAAA,IAC1E,WACS,2BAA2B,mBAAmB;AACnD,aAAO,KAAK,4BAA4B,QAAQ,eAAe;AAAA,IACnE;AACA,UAAM,IAAI,UAAU,oCAAoC;AAAA,EAC5D;AACA,SAAO;AACX,EAAE;AACF,IAAO,wBAAQ;;;ACpEA,0BAA0B,GAAG,GAAG,GAAG;AAC9C,SAAO,KAAK,MAAO,IAAI,MAAM,MAAO,IAAI,MAAM,MAAO,IAAI,MAAM,GAAK;AACxE;;;ACFA,IAAI,YAAwC,SAAU,SAAS,YAAY,GAAG,WAAW;AACrF,iBAAe,OAAO;AAAE,WAAO,iBAAiB,IAAI,QAAQ,IAAI,EAAE,SAAU,SAAS;AAAE,cAAQ,KAAK;AAAA,IAAG,CAAC;AAAA,EAAG;AAC3G,SAAO,IAAK,MAAM,KAAI,UAAU,SAAU,SAAS,QAAQ;AACvD,uBAAmB,OAAO;AAAE,UAAI;AAAE,aAAK,UAAU,KAAK,KAAK,CAAC;AAAA,MAAG,SAAS,GAAP;AAAY,eAAO,CAAC;AAAA,MAAG;AAAA,IAAE;AAC1F,sBAAkB,OAAO;AAAE,UAAI;AAAE,aAAK,UAAU,SAAS,KAAK,CAAC;AAAA,MAAG,SAAS,GAAP;AAAY,eAAO,CAAC;AAAA,MAAG;AAAA,IAAE;AAC7F,kBAAc,QAAQ;AAAE,aAAO,OAAO,QAAQ,OAAO,KAAK,IAAI,MAAM,OAAO,KAAK,EAAE,KAAK,WAAW,QAAQ;AAAA,IAAG;AAC7G,SAAM,aAAY,UAAU,MAAM,SAAS,cAAc,CAAC,CAAC,GAAG,KAAK,CAAC;AAAA,EACxE,CAAC;AACL;AACA,IAAI,cAA4C,SAAU,SAAS,MAAM;AACrE,MAAI,IAAI,EAAE,OAAO,GAAG,MAAM,WAAW;AAAE,QAAI,EAAE,KAAK;AAAG,YAAM,EAAE;AAAI,WAAO,EAAE;AAAA,EAAI,GAAG,MAAM,CAAC,GAAG,KAAK,CAAC,EAAE,GAAG,GAAG,GAAG,GAAG;AAC/G,SAAO,IAAI,EAAE,MAAM,KAAK,CAAC,GAAG,SAAS,KAAK,CAAC,GAAG,UAAU,KAAK,CAAC,EAAE,GAAG,OAAO,WAAW,cAAe,GAAE,OAAO,YAAY,WAAW;AAAE,WAAO;AAAA,EAAM,IAAI;AACvJ,gBAAc,GAAG;AAAE,WAAO,SAAU,GAAG;AAAE,aAAO,KAAK,CAAC,GAAG,CAAC,CAAC;AAAA,IAAG;AAAA,EAAG;AACjE,gBAAc,IAAI;AACd,QAAI;AAAG,YAAM,IAAI,UAAU,iCAAiC;AAC5D,WAAO;AAAG,UAAI;AACV,YAAI,IAAI,GAAG,KAAM,KAAI,GAAG,KAAK,IAAI,EAAE,YAAY,GAAG,KAAK,EAAE,YAAc,MAAI,EAAE,cAAc,EAAE,KAAK,CAAC,GAAG,KAAK,EAAE,SAAS,CAAE,KAAI,EAAE,KAAK,GAAG,GAAG,EAAE,GAAG;AAAM,iBAAO;AAC3J,YAAI,IAAI,GAAG;AAAG,eAAK,CAAC,GAAG,KAAK,GAAG,EAAE,KAAK;AACtC,gBAAQ,GAAG;AAAA,eACF;AAAA,eAAQ;AAAG,gBAAI;AAAI;AAAA,eACnB;AAAG,cAAE;AAAS,mBAAO,EAAE,OAAO,GAAG,IAAI,MAAM,MAAM;AAAA,eACjD;AAAG,cAAE;AAAS,gBAAI,GAAG;AAAI,iBAAK,CAAC,CAAC;AAAG;AAAA,eACnC;AAAG,iBAAK,EAAE,IAAI,IAAI;AAAG,cAAE,KAAK,IAAI;AAAG;AAAA;AAEpC,gBAAI,CAAE,KAAI,EAAE,MAAM,IAAI,EAAE,SAAS,KAAK,EAAE,EAAE,SAAS,OAAQ,IAAG,OAAO,KAAK,GAAG,OAAO,IAAI;AAAE,kBAAI;AAAG;AAAA,YAAU;AAC3G,gBAAI,GAAG,OAAO,KAAM,EAAC,KAAM,GAAG,KAAK,EAAE,MAAM,GAAG,KAAK,EAAE,KAAM;AAAE,gBAAE,QAAQ,GAAG;AAAI;AAAA,YAAO;AACrF,gBAAI,GAAG,OAAO,KAAK,EAAE,QAAQ,EAAE,IAAI;AAAE,gBAAE,QAAQ,EAAE;AAAI,kBAAI;AAAI;AAAA,YAAO;AACpE,gBAAI,KAAK,EAAE,QAAQ,EAAE,IAAI;AAAE,gBAAE,QAAQ,EAAE;AAAI,gBAAE,IAAI,KAAK,EAAE;AAAG;AAAA,YAAO;AAClE,gBAAI,EAAE;AAAI,gBAAE,IAAI,IAAI;AACpB,cAAE,KAAK,IAAI;AAAG;AAAA;AAEtB,aAAK,KAAK,KAAK,SAAS,CAAC;AAAA,MAC7B,SAAS,GAAP;AAAY,aAAK,CAAC,GAAG,CAAC;AAAG,YAAI;AAAA,MAAG,UAAE;AAAU,YAAI,IAAI;AAAA,MAAG;AACzD,QAAI,GAAG,KAAK;AAAG,YAAM,GAAG;AAAI,WAAO,EAAE,OAAO,GAAG,KAAK,GAAG,KAAK,QAAQ,MAAM,KAAK;AAAA,EACnF;AACJ;AAMA,IAAI,wBAAuC,WAAY;AACnD,kCAA+B,gBAAgB,UAAU;AACrD,QAAI,mBAAmB,QAAQ;AAAE,uBAAiB;AAAA,IAAM;AACxD,QAAI,aAAa,QAAQ;AAAE,iBAAW,OAAO;AAAA,IAAU;AACvD,QAAI,mBAAmB,MAAM;AACzB,uBAAiB,IAAI,wBAAgB,UAAU,kBAAkB,IAAI,uBAAe,CAAC;AAAA,IACzF;AACA,SAAK,iBAAiB;AACtB,SAAK,YAAY,IAAI,sBAAc,QAAQ;AAAA,EAC/C;AACA,yBAAsB,UAAU,QAAQ,SAAU,KAAK,UAAU;AAC7D,QAAI,aAAa,QAAQ;AAAE,iBAAW;AAAA,IAAG;AACzC,WAAO,UAAU,MAAM,QAAQ,QAAQ,WAAY;AAC/C,UAAI,QAAQ;AACZ,aAAO,YAAY,MAAM,SAAU,IAAI;AACnC,gBAAQ,GAAG;AAAA,eACF;AACD,qBAAS,IAAI,mBAAW,KAAK,QAAQ;AACrC,mBAAO,CAAC,GAAa,KAAK,eAAe,QAAQ,MAAM,CAAC;AAAA,eACvD;AACD,iCAAqB,GAAG,KAAK;AAC7B,mBAAO,CAAC,GAAc,KAAK,UAAU,SAAS,QAAQ,kBAAkB,CAAC;AAAA;AAAA,MAErF,CAAC;AAAA,IACL,CAAC;AAAA,EACL;AACA,SAAO;AACX,EAAE;AACF,IAAO,gCAAQ;;;AChEf;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAeO,IAAK,WAAL,kBAAK,cAAL;AACL,wBAAS;AACT,wBAAS;AAFC;AAAA;AAKL,IAAM,iBAAiB,WAAW,QAAQ;AAE1C,IAAM,0BAA0B,OAAO;AAAA,EAC5C,UAAU,SAAS,QAAQ,CAAC;AAAA,EAC5B,cAAc,SAAS,OAAO,CAAC;AAAA,EAC/B,WAAW,SAAS,MAAM,CAAC,QAAQ,CAAC,GAAG,QAAQ,EAAE,CAAC,CAAC,CAAC;AAAA,EACpD,OAAO,SAAS,QAAQ,CAAC;AAAA,EACzB,IAAI,OAAO;AAAA,EACX,cAAc,SAAS,OAAO,CAAC;AAAA,EAC/B,MAAM,SAAS,MAAM,CAAC,QAAQ,GAAG,OAAO,CAAC,CAAC,CAAC;AAAA,EAC3C,UAAU,SAAS,cAAc;AAAA,EACjC,OAAO,SAAS,OAAO,CAAC;AAAA,EACxB,YAAY,SAAS,OAAO,CAAC;AAC/B,CAAC;AAGM,IAAM,sBAAsB,OAAO;AAAA,EACxC,YAAY,MAAM,OAAO,CAAC;AAAA,EAC1B,IAAI,OAAO;AACb,CAAC;AAGM,IAAM,iBAAiB,OAAO;AAAA,EACnC,mBAAmB,SAAS,OAAO,CAAC;AAAA,EACpC,YAAY,MAAM,uBAAuB;AAAA,EACzC,QAAQ,SAAS,OAAO,CAAC;AAAA,EACzB,QAAQ,SAAS,OAAO,OAAO,GAAG,IAAI,CAAC,CAAC;AAAA,EACxC,aAAa,SAAS,OAAO,CAAC;AAAA,EAC9B,WAAW,SAAS,OAAO,CAAC;AAAA,EAC5B,UAAU,SAAS,OAAO,CAAC;AAAA,EAC3B,UAAU,SAAS,OAAO,CAAC;AAAA,EAC3B,QAAQ,SAAS,MAAM,mBAAmB,CAAC;AAAA,EAC3C,QAAQ,SAAS,MAAM,OAAO,CAAC,CAAC;AAAA,EAChC,SAAS,SAAS,OAAO,CAAC;AAC5B,CAAC;;;ADpCM,IAAM,wBAAwB,KAAK,yBAAyB,CAAC,IAAI,CAAC;AAIlE,IAAM,uBAAuB,QAAO;AAAA,EACzC,OAAO,QAAO;AAChB,CAAC;AAGM,IAAM,+BAA+B;AAIrC,IAAM,+BAA+B,MAAM,CAAC,sBAAsB,QAAO,EAAE,IAAI,QAAO,EAAE,CAAC,CAAC,CAAC;AAI3F,IAAM,+BAA+B,MAAM,CAAC,sBAAsB,QAAO,EAAE,OAAO,QAAO,EAAE,CAAC,CAAC,CAAC;AAI9F,IAAM,oCAAoC;AAI1C,IAAM,oCAAoC;AAI1C,IAAM,kCAAkC;AAIxC,IAAM,8BAA8B,MAAM;AAAA,EAC/C;AAAA,EACA,QAAO,EAAE,WAAW,UAAS,OAAM,QAAO,CAAC,SAAS,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;AAC3E,CAAC;AAGM,IAAM,uCAAuC,QAAO;AAAA,EACzD,SAAS,UAAS,4BAA4B;AAAA,EAC9C,SAAS,UAAS,4BAA4B;AAAA,EAC9C,YAAY,UAAS,+BAA+B;AAAA,EACpD,SAAS,UAAS,4BAA4B;AAAA,EAC9C,cAAc,UAAS,iCAAiC;AAAA,EACxD,cAAc,UAAS,iCAAiC;AAAA,EACxD,QAAQ,UAAS,2BAA2B;AAC9C,CAAC;AAGM,IAAM,uCAAuC,MAAM;AAAA,EACxD;AAAA,EACA,QAAO;AAAA,IACL,cAAc,UAAS,MAAM,CAAC,QAAO,CAAC,SAAS,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,GAAG,QAAO,CAAC,SAAS,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAAA,IACtG,UAAU,UAAS,OAAM,CAAC,MAAM,CAAC,QAAO,GAAG,QAAO,CAAC,CAAC,GAAG,QAAO,CAAC,CAAC,CAAC;AAAA,EACnE,CAAC;AACH,CAAC;AAGM,IAAM,uBAAuB,MAAM;AAAA,EACxC;AAAA,EACA,QAAO;AAAA,IACL,aAAa,UAAS,QAAO,CAAC;AAAA,IAC9B,kBAAkB;AAAA,EACpB,CAAC;AACH,CAAC;AAGM,IAAM,wBAAwB,QAAO,QAAO,GAAG,oBAAoB;AAGnE,IAAM,wCAAwC,QAAO;AAAA,EAC1D,IAAI,QAAO;AAAA,EACX,SAAS,QAAO;AAClB,CAAC;AAGM,IAAM,8BAA8B,QAAO;AAAA,EAChD,YAAY;AAAA,EACZ,QAAQ;AACV,CAAC;;;AE9FD;AACA;AAeO,IAAM,aAAwB;AAAA,EACnC,MAAM;AAAA,EACN,KAAK;AAAA,EACL,KAAK;AAAA,EACL,KAAK;AAAA,EACL,KAAK;AAAA,EACL,QAAQ;AAAA,EACR,MAAM;AAAA,EACN,KAAK;AACP;AAEO,IAAM,aAAwB;AAAA,EACnC,MAAM,CAAC,KAAM,KAAM,GAAI;AAAA,EACvB,KAAK,CAAC,KAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,EAAI;AAAA,EACpD,KAAK,CAAC,IAAM,IAAM,EAAI;AAAA,EACtB,KAAK,CAAC,IAAM,EAAI;AAAA,EAChB,MAAM,CAAC,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,EAAI;AAAA,EAE7E,KAAK,CAAC,IAAM,KAAM,KAAM,GAAI;AAAA,EAE5B,QAAQ,CAAC,IAAM,IAAM,KAAM,KAAM,GAAI;AAAA,EACrC,KAAK,CAAC,IAAM,IAAM,EAAI;AACxB;AAwBO,IAAM,iBAAN,cAA6B,MAAM;AAAA,EAGxC,AAAO,YAAY,SAAiB,MAAmB;AACrD,UAAM,OAAO;AAHf,wBAAO;AAIL,SAAK,OAAO;AACZ,SAAK,OAAO;AAAA,EACd;AACF;AAsBO,IAAM,cAAc,CAAC,YAA2B;AACrD,QAAM,QAAQ,IAAI,MAAM,mBAAmB,SAAS;AAEpD,SAAO;AACT;AAkDO,IAAM,wBAAwB,CAAC,WAAuC;AAC3E,MAAI,OAAsB;AAC1B,MAAI,QAAkB,CAAC;AAEvB,MAAI,CAAC,QAAQ;AACX,UAAM,IAAI,eACR,iLACA,2CACF;AAAA,EACF;AAEA,QAAM,cAAc,OAAO,UAAU,OAAO,QAAQ,GAAG,IAAI,CAAC;AAE5D,MAAI,OAAO,WAAW,aAAa;AACjC,WAAO,OAAO,KAAK,aAAa,QAAQ,EAAE,SAAS,QAAQ;AAAA,EAC7D,OAAO;AACL,WAAO,KAAK,WAAW;AAAA,EACzB;AAEA,QAAM,UAAU,IAAI,WAAW,KAAK,MAAM;AAE1C,WAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK,GAAG;AACvC,YAAQ,KAAK,KAAK,WAAW,CAAC;AAAA,EAChC;AAEA,aAAW,YAAY,YAAY;AACjC,UAAM,UAAU,WAAW;AAE3B,QAAI,aAAa,UAAU,WAAW,QAAQ,SAAS,QAAQ,QAAQ;AACrE,YAAM,aAAa,MAAM,KAAK,QAAQ,SAAS,GAAG,CAAC,CAAC;AACpD,YAAM,mBAAmB,MAAM,KAAK,QAAQ,SAAS,GAAG,EAAE,CAAC;AAE3D,UACE,WAAW,MAAM,CAAC,MAAM,UAAU,SAAS,QAAQ,MAAM,KACzD,iBAAiB,MAAM,CAAC,MAAM,UAAU,SAAS,QAAQ,QAAQ,EAAE,GACnE;AACA,eAAO,WAAW;AAAA,MACpB;AAAA,IACF,OAAO;AACL,cAAQ,MAAM,KAAK,QAAQ,SAAS,GAAG,SAAS,MAAM,CAAC;AAEvD,UAAI,WAAW,MAAM,MAAM,CAAC,MAAM,UAAU,SAAS,QAAQ,MAAM,GAAG;AACpE,eAAO,WAAW;AAAA,MACpB;AAAA,IACF;AAAA,EACF;AAEA,QAAM,IAAI,eACR,iLACA,2CACF;AACF;AAkFO,uBAAuB,WAA+B;AAC3D,MAAI;AAEJ,MAAI,OAAO,WAAW,aAAa;AAEjC,aAAS,OAAO,KAAK,SAAS,EAAE,SAAS,QAAQ;AAAA,EACnD,OAAO;AAEL,UAAM,eAAe,MAAM,UAAU,IAAI,KAAK,WAAW,CAAC,SAAiB,OAAO,aAAa,IAAI,CAAC,EAAE,KAAK,EAAE;AAE7G,aAAS,OAAO,KAAK,YAAY;AAAA,EACnC;AAEA,QAAM,WAAW,sBAAsB,MAAM;AAE7C,SAAO,QAAQ,mBAAmB;AACpC;;;AC5RO,IAAM,oBAAN,MAAwB;AAAA,EAW7B,AAAO,YAAY,SAAuB;AAV1C,wBAAU;AAEV,wBAAU,OAAc;AAExB,wBAAU,aAAoB;AAE9B,wBAAU;AAEV,wBAAU;AAGR,SAAK,gBAAgB,QAAQ,EAAE;AAC/B,SAAK,sBAAsB,QAAQ,QAAQ;AAE3C,SAAK,cAAc,QAAQ,cAAc,CAAC;AAE1C,QAAI,QAAQ,MAAM;AAChB,WAAK,QAAQ,QAAQ;AAAA,IACvB;AAEA,QAAI,QAAQ,IAAI;AACd,WAAK,MAAM,QAAQ;AAAA,IACrB;AAEA,QAAI,QAAQ,UAAU;AACpB,WAAK,YAAY,QAAQ;AAAA,IAC3B;AAEA,SAAK,oBAAoB,QAAQ,oBAAoB,CAAC;AAAA,EACxD;AAAA,EAEA,IAAW,aAAyB;AAClC,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAW,WAAW,YAAwB;AAC5C,SAAK,cAAc;AAAA,EACrB;AAAA,EAQA,AAAQ,gBAAgB,IAA8C;AACpE,QAAI,CAAC;AAAI,YAAM,IAAI,eAAe,kBAAkB;AAAA,EACtD;AAAA,EAQA,AAAQ,sBAAsB,UAA0D;AACtF,QAAI,CAAC;AAAU,YAAM,IAAI,eAAe,wBAAwB;AAAA,EAClE;AAAA,EAEA,IAAW,WAAmB;AAC5B,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAW,SAAS,UAAkB;AACpC,SAAK,sBAAsB,QAAQ;AAEnC,SAAK,YAAY;AAAA,EACnB;AAAA,EAEA,IAAW,KAAa;AACtB,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAW,GAAG,IAAY;AACxB,SAAK,gBAAgB,EAAE;AAEvB,SAAK,MAAM;AAAA,EACb;AAAA,EAEA,IAAW,OAA8B;AACvC,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAW,KAAK,MAA6B;AAC3C,QAAI,CAAC,MAAM;AACT,YAAM,IAAI,eAAe,cAAc;AAAA,IACzC;AAEA,SAAK,QAAQ;AAAA,EACf;AAAA,EAEA,IAAW,mBAA4C;AACrD,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAW,iBAAiB,kBAA2C;AACrE,SAAK,oBAAoB;AAAA,EAC3B;AAAA,EAEA,MAAa,YAA6B;AACxC,QAAI,KAAK,SAAS,KAAK,WAAW,KAAK,KAAK;AAAG,aAAO,KAAK;AAE3D,UAAM,cAAc,MAAM,KAAK,cAAc;AAE7C,WAAO,cAAc,IAAI,WAAW,WAAW,CAAC;AAAA,EAClD;AAAA,EAMA,AAAO,YAAY,SAAuB;AACxC,SAAK,KAAK;AAEV,QAAI,KAAK,UAAU;AACjB,UAAI,UAAU,KAAK,SAAS,MAAM,GAAG,EAAE,IAAI;AAE3C,UAAI,CAAC,SAAS;AACZ,kBAAU;AAAA,MACZ;AAEA,WAAK,WAAW,GAAG,WAAW;AAAA,IAChC;AAAA,EACF;AAAA,EAEA,MAAa,gBAAsC;AACjD,UAAM,OAAO,MAAO,OAAM,KAAK,OAAO,GAAG,YAAY;AAErD,WAAO;AAAA,EACT;AAAA,EAEA,MAAa,SAAwB;AACnC,QAAI,CAAC,KAAK,OAAO;AACf,YAAM,IAAI,eAAe,qBAAqB;AAAA,IAChD;AAEA,QAAI,KAAK,WAAW,KAAK,KAAK,GAAG;AAC/B,YAAM,OAAO,KAAK;AAElB,YAAM,CAAC,QAAQ,UAAU,KAAK,MAAM,GAAG;AAGvC,UAAK,EAAC,UAAU,CAAC,WAAW,KAAK,QAAQ;AACvC,eAAO,IAAI,KAAK,CAAC,IAAI,CAAC;AAAA,MACxB;AAEA,UAAI,CAAC,UAAU,CAAC,QAAQ;AACtB,cAAM,IAAI,eAAe,qBAAqB;AAAA,MAChD;AAGA,YAAM,OAAO,OAAO,QAAQ,SAAS,EAAE,EAAE,QAAQ,YAAY,EAAE;AAE/D,aAAO,IAAI,KAAK,CAAC,MAAM,GAAG,EAAE,KAAK,CAAC;AAAA,IACpC;AAEA,QAAI,KAAK,eAAe,KAAK,KAAK,GAAG;AACnC,aAAO,IAAI,KAAK,CAAC,KAAK,KAAK,CAAC;AAAA,IAC9B;AAEA,QAAI,KAAK,QAAQ,KAAK,KAAK,GAAG;AAC5B,aAAO,KAAK;AAAA,IACd;AAEA,UAAM,IAAI,eAAe,qBAAqB;AAAA,EAChD;AAAA,EAEA,MAAgB,eAAe,KAA4B;AACzD,UAAM,WAAW,MAAM,MAAM,GAAG;AAEhC,WAAO,SAAS,KAAK;AAAA,EACvB;AAAA,EAEA,AAAU,eAAe,MAA0B;AACjD,WAAO,gBAAgB;AAAA,EACzB;AAAA,EAEA,AAAU,WAAW,MAA0B;AAC7C,WAAO,OAAO,SAAS,YAAY,KAAK,WAAW,OAAO;AAAA,EAC5D;AAAA,EAEA,AAAU,QAAQ,MAA0B;AAC1C,WAAO,gBAAgB;AAAA,EACzB;AACF;;;ACjMO,IAAM,kBAAN,MAAsB;AAAA,EAK3B,AAAO,YAAY,SAAkC;AAJrD,wBAAU;AAEV,wBAAU,aAAqB;AAG7B,SAAK,YAAY;AAEjB,QAAI,SAAS,UAAU;AACrB,WAAK,YAAY,QAAQ;AAAA,IAC3B;AAAA,EACF;AAAA,EAEA,AAAO,QAAQ,WAAkC;AAC/C,SAAK,YAAY;AAAA,EACnB;AAAA,EAEA,AAAO,YAAkB;AACvB,SAAK,YAAY;AAAA,EACnB;AAAA,EAEA,IAAW,WAAoB;AAC7B,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAW,SAAS,OAAgB;AAClC,SAAK,YAAY;AAAA,EACnB;AAAA,EAEA,MAAa,UAAyB;AACpC,UAAM,YAAY,yCAAyC;AAAA,EAC7D;AAAA,EAEA,AAAU,kBAAkB,WAA2D;AACrF,QAAI,CAAC;AAAW,YAAM,YAAY,sEAAsE;AAAA,EAC1G;AACF;;;ACxCO,IAAM,cAAN,cAA0B,kBAAkB;AAAA,EACjD,AAAO,YAAY,SAAuB;AACxC,UAAM,OAAO;AAAA,EACf;AACF;;;ACQO,IAAM,+BAAN,cAA2C,gBAAgB;AAAA,EAChE,MAAa,cAAc,QAA4C;AACrE,gBAAY,8FAA8F;AAE1G,WAAO;AAAA,EACT;AAAA,EAEA,AAAO,WAAW,YAAoB,kBAAkC;AACtE,gBACE,iHACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,MAAc,4BAA0E;AACtF,SAAK,kBAAkB,KAAK,SAAS;AAErC,UAAM,SAA+B,CAAC;AACtC,UAAM,qBAA0D,CAAC;AAGjE,eAAW,aAAa,KAAK,UAAU,YAAY;AACjD,iBAAW,SAAS,UAAU,aAAa;AACzC,eAAO,KAAK;AAAA,UACV,mBAAmB;AAAA,UACnB;AAAA,UACA,MAAM,MAAM,KAAK,cAAc,KAAK;AAAA,QACtC,CAAC;AAAA,MACH;AAAA,IACF;AAIA,eAAW,SAAS,QAAQ;AAE1B,iBAAW,gBAAgB,QAAQ;AACjC,YACE,MAAM,MAAM,OAAO,aAAa,MAAM,MACtC,CAAC,MAAM,qBACP,CAAC,aAAa,qBACd,MAAM,QACN,aAAa,QACb,KAAK,WAAW,MAAM,MAAM,aAAa,IAAI,IAAI,GAEjD;AAEA,cAAI,CAAC,mBAAmB,MAAM,MAAM,aAAa,CAAC,mBAAmB,aAAa,MAAM,WAAW;AACjG,yBAAa,oBAAoB;AAEjC,+BAAmB,MAAM,MAAM,YAAY,CAAC,aAAa,KAAK;AAAA,UAChE,WAAW,mBAAmB,aAAa,MAAM,WAAW;AAE1D,gBAAI,CAAC,mBAAmB,aAAa,MAAM,WAAW,KAAK,CAAC,SAAS,KAAK,OAAO,MAAM,MAAM,EAAE,GAAG;AAChG,oBAAM,oBAAoB;AAC1B,iCAAmB,aAAa,MAAM,WAAW,KAAK,MAAM,KAAK;AAAA,YACnE;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAQA,AAAO,8BACL,WACA,oBACM;AACN,eAAW,OAAO,oBAAoB;AACpC,UAAI,KAAK;AACP,2BAAmB,MAAM,QAAQ,CAAC,SAAS;AAGzC,cAAI,UAAU,MAAM;AAClB,kBAAM,kBAAkB,UAAU,KAAK;AAEvC,gBAAI,iBAAiB;AACnB,8BAAgB,QAAQ,CAAC,UAAU;AACjC,oBAAI,OAAO,SAAS,OAAO,OAAO;AAIhC,sBAAI,MAAM,MAAM,KAAK,UAAU;AAC7B,0BAAM,WAAW;AAEjB,0BAAM,IAAI;AAAA,kBACZ;AAAA,gBACF;AAAA,cACF,CAAC;AAAA,YACH;AAAA,UACF;AAAA,QACF,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAsB,UAAyB;AAC7C,SAAK,kBAAkB,KAAK,SAAS;AAGrC,UAAM,qBAA0D,MAAM,KAAK,0BAA0B;AAGrG,SAAK,UAAU,WAAW,QAAQ,CAAC,cAAc;AAC/C,WAAK,8BAA8B,WAAW,kBAAkB;AAAA,IAClE,CAAC;AAGD,UAAM,eAA4C,CAAC;AACnD,UAAM,SAAS,KAAK,UAAU,UAAU;AAExC,eAAW,OAAO,oBAAoB;AACpC,UAAI,KAAK;AACP,mBAAW,SAAS,QAAQ;AAC1B,cAAI,MAAM,aAAa,OAAO,MAAM,SAAS,QAAW;AACtD,yBAAa,OAAO,IAAI,YAAY;AAAA,cAClC,MAAM,MAAM;AAAA,cACZ,IAAI,MAAM;AAAA,cACV,UAAU,MAAM;AAAA,YAClB,CAAC;AAAA,UACH;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,QAAI,OAAO,KAAK,YAAY,EAAE,WAAW,OAAO,KAAK,kBAAkB,EAAE;AACvE,kBAAY,0EAA0E;AAGxF,eAAW,OAAO,oBAAoB;AACpC,UAAI,KAAK;AACP,2BAAmB,MAAM,QAAQ,CAAC,UAAU;AAC1C,cAAI,MAAM,iBAAiB,QAAQ;AACjC,uBAAW,mBAAmB,MAAM,kBAAkB;AACpD,8BAAgB,YAAY,OAAO,gBAAgB,YAAY,QAAQ,KAAK,GAAG,CAAC;AAEhF,oBAAM,cAAc,aAAa;AAEjC,kBAAI,gBAAgB,QAAW;AAC7B,gCAAgB,YAAY,KAAK,WAAW;AAE5C,4BAAY,iBAAiB,KAAK,eAAe;AAAA,cACnD;AAAA,YACF;AAAA,UACF;AAAA,QACF,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF;AACF;;;ACtKO,IAAM,yBAAN,cAAqC,6BAA6B;AAAA,EACvE,MAAsB,cAAc,OAA2C;AAC7E,UAAM,UAAU,IAAI,8BAAsB;AAC1C,UAAM,YAAY,IAAI,IAAI,MAAM,MAAM,UAAU,CAAC;AAEjD,UAAM,WAAW,MAAM,QAAQ,MAAM,SAAS;AAE9C,WAAO,SAAS;AAAA,EAClB;AAAA,EAEA,AAAgB,WAAW,WAAmB,iBAAiC;AAC7E,UAAM,UAAU,IAAI,aAAK,SAAS;AAClC,UAAM,aAAa,IAAI,aAAK,eAAe;AAE3C,WAAO,QAAQ,mBAAmB,UAAU;AAAA,EAC9C;AACF","sourcesContent":[null,null,null,null,null,"var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\n        to[j] = from[i];\n    return to;\n};\nvar VanilaConverter = /** @class */ (function () {\n    function VanilaConverter(document, glayScaleCalculator, resizer) {\n        this.document = document;\n        this.glayScaleCalculator = glayScaleCalculator;\n        this.resizer = resizer;\n    }\n    VanilaConverter.prototype.createCanvasRenderingContext2D = function (width, height) {\n        var canvas = this.document.createElement('canvas');\n        canvas.width = width;\n        canvas.height = height;\n        canvas.setAttribute('style', 'image-rendering: -webkit-optimize-contrast; image-rendering: crisp-edges;');\n        var ctx = canvas.getContext('2d');\n        if (ctx === null) {\n            throw new ReferenceError('undefined CanvasRenderingContext2D');\n        }\n        ctx.mozImageSmoothingEnabled = true;\n        ctx.webkitImageSmoothingEnabled = true;\n        ctx.msImageSmoothingEnabled = true;\n        ctx.imageSmoothingEnabled = true;\n        return ctx;\n    };\n    VanilaConverter.prototype.convert = function (source) {\n        var _this = this;\n        var img = new Image();\n        var result = (new Promise(function (resolve) {\n            img.onload = function () {\n                var ctx = _this.createCanvasRenderingContext2D(img.width, img.height);\n                ctx.drawImage(img, 0, 0, img.width, img.height);\n                var colorMap = ctx.getImageData(0, 0, img.width, img.height).data;\n                resolve(colorMap);\n            };\n        }))\n            .then(function (colorMap) {\n            return _this.resizer.resize(colorMap, img.width, img.height, source.width, source.height);\n        }).then(function (resizedColorMap) {\n            var glayArraySouce = __spreadArray([], __read(Array(resizedColorMap.length / 4).keys())).map(function (i) {\n                var index = i * 4;\n                var _a = __read([\n                    resizedColorMap[index],\n                    resizedColorMap[index + 1],\n                    resizedColorMap[index + 2]\n                ], 3), r = _a[0], g = _a[1], b = _a[2];\n                return _this.glayScaleCalculator(r, g, b);\n            });\n            return new Uint8ClampedArray(glayArraySouce);\n        });\n        img.src = source.url.toString();\n        return result;\n    };\n    return VanilaConverter;\n}());\nexport default VanilaConverter;\n","var HashSource = /** @class */ (function () {\n    function HashSource(url, hashSize) {\n        if (hashSize === void 0) { hashSize = 8; }\n        this.url = url;\n        this.hashSize = hashSize;\n        this.width = hashSize + 1;\n        this.height = hashSize;\n    }\n    HashSource.prototype.calculateArea = function () {\n        return this.width * this.height;\n    };\n    return HashSource;\n}());\nexport default HashSource;\n","import { lanczos } from '@rgba-image/lanczos';\nvar LanczosResizer = /** @class */ (function () {\n    function LanczosResizer() {\n    }\n    LanczosResizer.prototype.resize = function (source, nativeWidth, nativeHeight, expectedWidth, expectedHeight) {\n        var sourceImageData = (new ImageDataSouce(nativeWidth, nativeHeight, source));\n        var destImageData = (new ImageDataSouce(expectedWidth, expectedHeight, new Uint8ClampedArray(expectedWidth * expectedHeight * 4)));\n        lanczos(sourceImageData, destImageData);\n        return destImageData.data;\n    };\n    return LanczosResizer;\n}());\nexport default LanczosResizer;\nvar ImageDataSouce = /** @class */ (function () {\n    function ImageDataSouce(width, height, source) {\n        this.width = width;\n        this.height = height;\n        this.data = source;\n    }\n    return ImageDataSouce;\n}());\n","var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\n        to[j] = from[i];\n    return to;\n};\nvar Hash = /** @class */ (function () {\n    function Hash(rawHash) {\n        if (rawHash.split('').find(function (row) { return (row !== '1' && row !== '0'); })) {\n            throw new TypeError('Not bits.');\n        }\n        this.rawHash = rawHash;\n    }\n    Hash.prototype.getHammingDistance = function (hash) {\n        if (this.rawHash.length !== hash.rawHash.length) {\n            throw new TypeError('Not equal to hash length.');\n        }\n        var target = hash.rawHash.split('');\n        var diff = this.rawHash.split('').filter(function (row, index) { return row !== (target[index] || '0'); });\n        return diff.length;\n    };\n    Hash.prototype.toString = function () {\n        return this.calcuateHexadecimal(this.rawHash.split('').map(function (row) { return (row === '1') ? 1 : 0; }));\n    };\n    Hash.prototype.arrayChunk = function (array, chunk) {\n        return __spreadArray([], __read(Array(Math.ceil(array.length / chunk)).keys())).map(function (index) { return array.slice(index * chunk, (index * chunk) + chunk); });\n    };\n    Hash.prototype.calcuateHexadecimal = function (binalyNumbers) {\n        return this.arrayChunk(binalyNumbers, 4)\n            .map(function (row) { return parseInt(row.join(''), 2).toString(16); }).join('');\n    };\n    return Hash;\n}());\nexport default Hash;\n","var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\n        to[j] = from[i];\n    return to;\n};\nimport Hash from \"./Hash\";\nvar HashGenerator = /** @class */ (function () {\n    function HashGenerator(document) {\n        this.document = document;\n    }\n    HashGenerator.prototype.generateByImage = function (source, glayImage) {\n        glayImage.width = source.width;\n        glayImage.height = source.height;\n        var canvas = this.document.createElement('canvas');\n        var context = canvas.getContext('2d');\n        if (context === null) {\n            throw new ReferenceError('undefined CanvasRenderingContext2D');\n        }\n        context.drawImage(glayImage, 0, 0, source.width, source.height);\n        return this.generate(source, context);\n    };\n    HashGenerator.prototype.generateByCanvasRenderingContext2D = function (source, glayImageDrawingCanvasContext) {\n        var imageData = glayImageDrawingCanvasContext.getImageData(0, 0, source.width, source.height).data;\n        var glayArray = new Uint8ClampedArray(__spreadArray([], __read(Array(imageData.length / 4).keys())).map(function (i) {\n            var index = i * 4;\n            return imageData[index];\n        }));\n        return this.generate(source, glayArray);\n    };\n    HashGenerator.prototype.generateByUint8ClampedArray = function (source, glayArray) {\n        if (glayArray.length !== source.calculateArea()) {\n            throw new Error(\"Not convertable grayArray, convertable grayArray length is \" + source.calculateArea());\n        }\n        var binaryNumbers = Array.from(glayArray)\n            .map(function (row, index, colors) { return ((row <= colors[index + 1]) ? 1 : 0); })\n            .filter(function (_, index) { return (index + 1) % source.width !== 0; }).join('');\n        return new Hash(binaryNumbers);\n    };\n    HashGenerator.prototype.generate = function (source, glayImageSource) {\n        if (glayImageSource instanceof HTMLImageElement) {\n            return this.generateByImage(source, glayImageSource);\n        }\n        else if (glayImageSource instanceof CanvasRenderingContext2D) {\n            return this.generateByCanvasRenderingContext2D(source, glayImageSource);\n        }\n        else if (glayImageSource instanceof Uint8ClampedArray) {\n            return this.generateByUint8ClampedArray(source, glayImageSource);\n        }\n        throw new TypeError('Not generatable glay image source.');\n    };\n    return HashGenerator;\n}());\nexport default HashGenerator;\n","export default function ITU_R601_2Method(r, g, b) {\n    return Math.round((r * 299 / 1000 + g * 587 / 1000 + b * 114 / 1000));\n}\n;\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport VanilaConverter from \"./HashableImageSourceConverter/DifferenceHash/VanilaConverter\";\nimport HashSource from \"./HashSource\";\nimport LanczosResizer from \"./HashableImageSourceConverter/Resizer/LanczosResizer\";\nimport HashGenerator from \"./HashGenerator\";\nimport ITU_R601_2Method from \"./HashableImageSourceConverter/GlayScaleCalculator/ITU_R601_2Method\";\nvar DifferenceHashBuilder = /** @class */ (function () {\n    function DifferenceHashBuilder(dHashConverter, document) {\n        if (dHashConverter === void 0) { dHashConverter = null; }\n        if (document === void 0) { document = window.document; }\n        if (dHashConverter === null) {\n            dHashConverter = new VanilaConverter(document, ITU_R601_2Method, new LanczosResizer());\n        }\n        this.dHashConverter = dHashConverter;\n        this.generator = new HashGenerator(document);\n    }\n    DifferenceHashBuilder.prototype.build = function (url, hashSize) {\n        if (hashSize === void 0) { hashSize = 8; }\n        return __awaiter(this, void 0, void 0, function () {\n            var source, hashableImageSouce;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        source = new HashSource(url, hashSize);\n                        return [4 /*yield*/, this.dHashConverter.convert(source)];\n                    case 1:\n                        hashableImageSouce = _a.sent();\n                        return [2 /*return*/, this.generator.generate(source, hashableImageSouce)];\n                }\n            });\n        });\n    };\n    return DifferenceHashBuilder;\n}());\nexport default DifferenceHashBuilder;\n","/**\n * Copyright 2023 Design Barn Inc.\n */\n\nimport type { ZipOptions } from 'fflate';\nimport { safeParse, flatten } from 'valibot';\n\nimport {\n  DotLottieStatesSchema,\n  type DotLottieStates,\n  type DotLottieStateMachineDescriptor,\n  DotLottieStateMachineDescriptorSchema,\n} from './dotlottie-state';\nimport { DotLottieError, ErrorCodes, createError } from './utils';\n\nexport interface DotLottieStateMachineCommonOptions {\n  descriptor: DotLottieStateMachineDescriptor;\n  states: DotLottieStates;\n  zipOptions?: ZipOptions;\n}\n\nexport class DotLottieStateMachineCommon {\n  protected _descriptor: DotLottieStateMachineDescriptor;\n\n  protected _zipOptions: ZipOptions;\n\n  protected _states: DotLottieStates;\n\n  public constructor(options: DotLottieStateMachineCommonOptions) {\n    this._requireValidId(options.descriptor.id);\n    this._requireValidStates(options.states);\n    this._requireValidDescriptor(options.descriptor);\n\n    this._descriptor = options.descriptor;\n\n    this._zipOptions = options.zipOptions ?? {};\n\n    this._states = options.states;\n  }\n\n  public get zipOptions(): ZipOptions {\n    return this._zipOptions;\n  }\n\n  public set zipOptions(zipOptions: ZipOptions) {\n    this._zipOptions = zipOptions;\n  }\n\n  public get id(): string {\n    return this._descriptor.id;\n  }\n\n  public set id(id: string) {\n    this._requireValidId(id);\n\n    this._descriptor.id = id;\n  }\n\n  public get states(): DotLottieStates {\n    return this._states;\n  }\n\n  public set states(states: DotLottieStates) {\n    this._states = states;\n  }\n\n  public get initial(): string {\n    return this._descriptor.initial;\n  }\n\n  public set initial(initial: string) {\n    this._descriptor.initial = initial;\n  }\n\n  public get descriptor(): DotLottieStateMachineDescriptor {\n    return this._descriptor;\n  }\n\n  public set descriptor(descriptor: DotLottieStateMachineDescriptor) {\n    this._descriptor = descriptor;\n  }\n\n  public toString(): string {\n    return JSON.stringify({\n      descriptor: this._descriptor,\n      states: this._states,\n    });\n  }\n\n  protected _requireValidId(id: string | undefined): void {\n    if (!id) {\n      throw createError('Invalid id.');\n    }\n  }\n\n  protected _requireValidDescriptor(descriptor: DotLottieStateMachineDescriptor): void {\n    const result = safeParse(DotLottieStateMachineDescriptorSchema, descriptor);\n\n    if (!result.success) {\n      const error = `Invalid state machine declaration, ${JSON.stringify(flatten(result.error).nested, null, 2)}`;\n\n      throw new DotLottieError(`Invalid descriptor: ${error}`, ErrorCodes.INVALID_STATEMACHINE);\n    }\n  }\n\n  protected _requireValidStates(states: DotLottieStates): void {\n    const result = safeParse(DotLottieStatesSchema, states);\n\n    if (!result.success) {\n      const error = `Invalid state machine declaration, ${JSON.stringify(flatten(result.error).nested, null, 2)}`;\n\n      throw new DotLottieError(`Invalid states: ${error}`, ErrorCodes.INVALID_STATEMACHINE);\n    }\n  }\n}\n","/**\n * Copyright 2023 Design Barn Inc.\n */\n\nimport type { Output } from 'valibot';\nimport {\n  merge,\n  number,\n  object,\n  optional,\n  string,\n  union,\n  omit,\n  record,\n  tuple,\n  maxValue,\n  minValue,\n  array,\n} from 'valibot';\n\nimport { ManifestAnimationSchema } from './manifest';\n\nexport const PlaybackOptionsSchema = omit(ManifestAnimationSchema, ['id']);\n\nexport type PlaybackOptions = Output<typeof PlaybackOptionsSchema>;\n\nexport const TransitionableSchema = object({\n  state: string(),\n});\nexport type Transitionable = Output<typeof TransitionableSchema>;\n\nexport const StateTransitionOnClickSchema = TransitionableSchema;\n\nexport type StateTransitionOnClick = Output<typeof StateTransitionOnClickSchema>;\n\nexport const StateTransitionOnAfterSchema = merge([TransitionableSchema, object({ ms: number() })]);\n\nexport type StateTransitionOnAfter = Output<typeof StateTransitionOnAfterSchema>;\n\nexport const StateTransitionOnEnterSchema = merge([TransitionableSchema, object({ count: number() })]);\n\nexport type StateTransitionOnEnter = Output<typeof StateTransitionOnEnterSchema>;\n\nexport const StateTransitionOnMouseEnterSchema = TransitionableSchema;\n\nexport type StateTransitionOnMouseEnter = Output<typeof StateTransitionOnMouseEnterSchema>;\n\nexport const StateTransitionOnMouseLeaveSchema = TransitionableSchema;\n\nexport type StateTransitionOnMouseLeave = Output<typeof StateTransitionOnMouseLeaveSchema>;\n\nexport const StateTransitionOnCompleteSchema = TransitionableSchema;\n\nexport type StateTransitionOnComplete = Output<typeof StateTransitionOnCompleteSchema>;\n\nexport const StateTransitionOnShowSchema = merge([\n  TransitionableSchema,\n  object({ threshold: optional(array(number([minValue(0), maxValue(1)]))) }),\n]);\nexport type StateTransitionOnShow = Output<typeof StateTransitionOnShowSchema>;\n\nexport const DotLottieStateTransitionEventsSchema = object({\n  onAfter: optional(StateTransitionOnAfterSchema),\n  onClick: optional(StateTransitionOnClickSchema),\n  onComplete: optional(StateTransitionOnCompleteSchema),\n  onEnter: optional(StateTransitionOnEnterSchema),\n  onMouseEnter: optional(StateTransitionOnMouseEnterSchema),\n  onMouseLeave: optional(StateTransitionOnMouseLeaveSchema),\n  onShow: optional(StateTransitionOnShowSchema),\n});\nexport type DotLottieStateTransitionEvents = Output<typeof DotLottieStateTransitionEventsSchema>;\n\nexport const DotLottieStatePlaybackSettingsSchema = merge([\n  PlaybackOptionsSchema,\n  object({\n    playOnScroll: optional(tuple([number([minValue(0), maxValue(1)]), number([minValue(0), maxValue(1)])])),\n    segments: optional(union([tuple([number(), number()]), string()])),\n  }),\n]);\nexport type DotLottieStatePlaybackSettings = Output<typeof DotLottieStatePlaybackSettingsSchema>;\n\nexport const DotLottieStateSchema = merge([\n  DotLottieStateTransitionEventsSchema,\n  object({\n    animationId: optional(string()),\n    playbackSettings: DotLottieStatePlaybackSettingsSchema,\n  }),\n]);\nexport type DotLottieState = Output<typeof DotLottieStateSchema>;\n\nexport const DotLottieStatesSchema = record(string(), DotLottieStateSchema);\nexport type DotLottieStates = Output<typeof DotLottieStatesSchema>;\n\nexport const DotLottieStateMachineDescriptorSchema = object({\n  id: string(),\n  initial: string(),\n});\nexport type DotLottieStateMachineDescriptor = Output<typeof DotLottieStateMachineDescriptorSchema>;\n\nexport const DotLottieStateMachineSchema = object({\n  descriptor: DotLottieStateMachineDescriptorSchema,\n  states: DotLottieStatesSchema,\n});\nexport type DotLottieStateMachine = Output<typeof DotLottieStateMachineSchema>;\n","/**\n * Copyright 2023 Design Barn Inc.\n */\n\nimport {\n  object,\n  type Output,\n  string,\n  array,\n  boolean,\n  number,\n  union,\n  optional,\n  record,\n  any,\n  nativeEnum,\n  literal,\n} from 'valibot';\n\nexport enum PlayMode {\n  Bounce = 'bounce',\n  Normal = 'normal',\n}\n\nexport const PlayModeSchema = nativeEnum(PlayMode);\n\nexport const ManifestAnimationSchema = object({\n  autoplay: optional(boolean()),\n  defaultTheme: optional(string()),\n  direction: optional(union([literal(1), literal(-1)])),\n  hover: optional(boolean()),\n  id: string(),\n  intermission: optional(number()),\n  loop: optional(union([boolean(), number()])),\n  playMode: optional(PlayModeSchema),\n  speed: optional(number()),\n  themeColor: optional(string()),\n});\nexport type ManifestAnimation = Output<typeof ManifestAnimationSchema>;\n\nexport const ManifestThemeSchema = object({\n  animations: array(string()),\n  id: string(),\n});\nexport type ManifestTheme = Output<typeof ManifestThemeSchema>;\n\nexport const ManifestSchema = object({\n  activeAnimationId: optional(string()),\n  animations: array(ManifestAnimationSchema),\n  author: optional(string()),\n  custom: optional(record(string(), any())),\n  description: optional(string()),\n  generator: optional(string()),\n  keywords: optional(string()),\n  revision: optional(number()),\n  themes: optional(array(ManifestThemeSchema)),\n  states: optional(array(string())),\n  version: optional(string()),\n});\n\nexport type Manifest = Output<typeof ManifestSchema>;\n","/**\n * Copyright 2023 Design Barn Inc.\n */\n\n/* eslint-disable guard-for-in */\n\nimport type { Animation as AnimationData, Asset } from '@lottiefiles/lottie-types';\nimport type { UnzipFileFilter, Unzipped } from 'fflate';\nimport { unzip as fflateUnzip, strFromU8 } from 'fflate';\nimport { flatten, safeParse } from 'valibot';\n\nimport type { LottieStateMachine } from '../lottie-state-machine';\n\nimport type { Manifest } from './manifest';\nimport { ManifestSchema } from './manifest';\n\nexport interface MimeTypes {\n  [key: string]: string;\n}\n\nexport interface MimeCodes {\n  [key: string]: number[];\n}\n\nexport const MIME_TYPES: MimeTypes = {\n  jpeg: 'image/jpeg',\n  png: 'image/png',\n  gif: 'image/gif',\n  bmp: 'image/bmp',\n  svg: 'image/svg+xml',\n  svgxml: 'image/svg+xml',\n  webp: 'image/webp',\n  mp3: 'audio/mp3',\n};\n\nexport const MIME_CODES: MimeCodes = {\n  jpeg: [0xff, 0xd8, 0xff],\n  png: [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a],\n  gif: [0x47, 0x49, 0x46],\n  bmp: [0x42, 0x4d],\n  webp: [0x52, 0x49, 0x46, 0x46, 0x3f, 0x3f, 0x3f, 0x3f, 0x57, 0x45, 0x42, 0x50],\n  // This covers <svg..\n  svg: [0x3c, 0x73, 0x76, 0x67],\n  // This covers <?xml..\n  svgxml: [0x3c, 0x3f, 0x78, 0x6d, 0x6c],\n  mp3: [0x49, 0x44, 0x33],\n};\n\nexport interface MimeToExtension {\n  [key: string]: string;\n}\n\nexport const MIME_TO_EXTENSION: MimeToExtension = {\n  'image/jpeg': 'jpeg',\n  'image/png': 'png',\n  'image/gif': 'gif',\n  'image/bmp': 'bmp',\n  'image/svg+xml': 'svg',\n  'image/webp': 'webp',\n  'audio/mpeg': 'mpeg',\n  'audio/mp3': 'mp3',\n};\n\nexport enum ErrorCodes {\n  ASSET_NOT_FOUND = 'ASSET_NOT_FOUND',\n  INVALID_DOTLOTTIE = 'INVALID_DOTLOTTIE',\n  INVALID_STATEMACHINE = 'INVALID_STATEMACHINE',\n  INVALID_URL = 'INVALID_URL',\n}\n\nexport class DotLottieError extends Error {\n  public code: ErrorCodes | undefined;\n\n  public constructor(message: string, code?: ErrorCodes) {\n    super(message);\n    this.name = '[dotlottie-js]';\n    this.code = code;\n  }\n}\n\n/**\n * Creates an Error object with the specified message.\n *\n * @remarks\n * This function accepts a message string and constructs a new Error object prefixed with \"[dotlottie-js]: \".\n *\n * @deprecated\n * This function has been deprecated in favor of using the {@link DotLottieError} class directly.\n *\n * @param message - The error message to include in the Error object.\n * @returns An Error object with the specified message, prefixed with \"[dotlottie-js]: \".\n *\n * @example\n * ```typescript\n * const message = 'DotLottie not found';\n * const error = createError(message);\n * ```\n *\n * @public\n */\nexport const createError = (message: string): Error => {\n  const error = new Error(`[dotlottie-js]: ${message}`);\n\n  return error;\n};\n\n/**\n * Converts a base64 string into a Uint8Array.\n *\n * @remarks\n * This function accepts a base64 string and returns a Uint8Array containing the decoded bytes.\n *\n * @param base64String - The base64-encoded string to decode.\n * @returns A Uint8Array containing the decoded bytes.\n *\n * @example\n * ```typescript\n * const base64 = 'SGVsbG8gd29ybGQ=';\n * const array = base64ToUint8Array(base64);\n * ```\n *\n * @public\n */\nexport const base64ToUint8Array = (base64String: string): Uint8Array => {\n  const withoutMeta = base64String.substring(base64String.indexOf(',') + 1);\n  const binaryString =\n    typeof window === 'undefined' ? Buffer.from(withoutMeta, 'base64').toString('binary') : atob(withoutMeta);\n\n  const uint8Array = new Uint8Array(binaryString.length);\n\n  for (let i = 0; i < binaryString.length; i += 1) {\n    uint8Array[i] = binaryString.charCodeAt(i);\n  }\n\n  return uint8Array;\n};\n\n/**\n * Determines the MIME type from a base64-encoded string.\n *\n * @remarks\n * This function accepts a base64-encoded string and determines its MIME type by looking at the first few bytes.\n *\n * @param base64 - The base64-encoded string to analyze.\n * @returns The MIME type as a string, or null if the type cannot be determined.\n *\n * @example\n * ```typescript\n * const base64 = 'data:image/jpeg;base64,...';\n * const mimeType = getMimeTypeFromBase64(base64);\n * ```\n *\n * @public\n */\nexport const getMimeTypeFromBase64 = (base64: string): string | undefined => {\n  let data: string | null = null;\n  let bytes: number[] = [];\n\n  if (!base64) {\n    throw new DotLottieError(\n      'Failed to determine the MIME type from the base64 asset string. Please check the input data. Supported asset types for dotlottie-js  are: jpeg, png, gif, bmp, svg, webp, mp3',\n      ErrorCodes.INVALID_DOTLOTTIE,\n    );\n  }\n\n  const withoutMeta = base64.substring(base64.indexOf(',') + 1);\n\n  if (typeof window === 'undefined') {\n    data = Buffer.from(withoutMeta, 'base64').toString('binary');\n  } else {\n    data = atob(withoutMeta);\n  }\n\n  const bufData = new Uint8Array(data.length);\n\n  for (let i = 0; i < data.length; i += 1) {\n    bufData[i] = data.charCodeAt(i);\n  }\n\n  for (const mimeType in MIME_CODES) {\n    const dataArr = MIME_CODES[mimeType];\n\n    if (mimeType === 'webp' && dataArr && bufData.length > dataArr.length) {\n      const riffHeader = Array.from(bufData.subarray(0, 4));\n      const webpFormatMarker = Array.from(bufData.subarray(8, 12));\n\n      if (\n        riffHeader.every((byte, index) => byte === dataArr[index]) &&\n        webpFormatMarker.every((byte, index) => byte === dataArr[index + 8])\n      ) {\n        return MIME_TYPES[mimeType];\n      }\n    } else {\n      bytes = Array.from(bufData.subarray(0, dataArr?.length));\n\n      if (dataArr && bytes.every((byte, index) => byte === dataArr[index])) {\n        return MIME_TYPES[mimeType];\n      }\n    }\n  }\n\n  throw new DotLottieError(\n    'Failed to determine the MIME type from the base64 asset string. Please check the input data. Supported asset types for dotlottie-js  are: jpeg, png, gif, bmp, svg, webp, mp3',\n    ErrorCodes.INVALID_DOTLOTTIE,\n  );\n};\n\n/**\n * Determines the file extension from a base64-encoded string.\n *\n * @remarks\n * This function accepts a base64-encoded string and determines its file extension by examining the MIME type.\n *\n * @param base64 - The base64-encoded string to analyze.\n * @returns The file extension as a string, or 'png' if the extension cannot be determined.\n *\n * @example\n * ```typescript\n * const base64 = 'data:image/jpeg;base64,...';\n * const extension = getExtensionTypeFromBase64(base64);\n * ```\n *\n * @public\n */\nexport const getExtensionTypeFromBase64 = (base64: string): string | null => {\n  const mimeType = getMimeTypeFromBase64(base64);\n\n  if (!mimeType) {\n    const ext = base64.split(';')[0]?.split('/')[1];\n\n    if (ext) {\n      return MIME_TO_EXTENSION[ext] || null;\n    }\n\n    return null;\n  }\n\n  return MIME_TO_EXTENSION[mimeType] || null;\n};\n\n/**\n * Validates a given URL string.\n *\n * @remarks\n * This function accepts a URL string and checks whether it's a valid URL according to the URL constructor.\n * It returns `true` if the URL is valid, `false` otherwise.\n *\n * @param url - The URL string to validate.\n * @returns `true` if the URL is valid, `false` otherwise.\n *\n * @example\n * ```typescript\n * const url = 'https://example.com';\n * const isValid = isValidURL(url); // true\n * ```\n *\n * @public\n */\nexport const isValidURL = (url: string): boolean => {\n  try {\n    // eslint-disable-next-line no-new\n    new URL(url);\n\n    return true;\n  } catch {\n    return false;\n  }\n};\n\n/**\n * Creates a data URL from a Uint8Array.\n *\n * @remarks\n * This function accepts a Uint8Array and a file extension, then converts the Uint8Array into a base64 data URL string.\n * The mimeType is determined based on the provided file extension, or defaults to 'image/png' if the extension is not recognized.\n *\n * @param uint8Data - The Uint8Array containing the binary data.\n * @param fileExtension - The file extension used to determine the mimeType (e.g., 'png', 'jpeg').\n * @returns The data URL string.\n *\n * @example\n * ```typescript\n * const uint8Data = new Uint8Array(...);\n * const fileExtension = 'png';\n * const dataUrl = dataUrlFromU8(uint8Data, fileExtension);\n * ```\n */\nexport function dataUrlFromU8(uint8Data: Uint8Array): string {\n  let base64: string;\n\n  if (typeof window === 'undefined') {\n    // Using Node.js Buffer for non-browser environments\n    base64 = Buffer.from(uint8Data).toString('base64');\n  } else {\n    // Using window.btoa for browser environments\n    const binaryString = Array.prototype.map.call(uint8Data, (byte: number) => String.fromCharCode(byte)).join('');\n\n    base64 = window.btoa(binaryString);\n  }\n\n  const mimeType = getMimeTypeFromBase64(base64);\n\n  return `data:${mimeType};base64,${base64}`;\n}\n\n/**\n * Checks if an asset is an image asset.\n *\n * @remarks\n * This function accepts an asset object and determines whether it represents an image asset.\n * It returns `true` if it's an image asset, `false` otherwise.\n *\n * @param asset - The asset object to check.\n * @returns `true` if it's an image asset, `false` otherwise.\n *\n * @example\n * ```typescript\n * const asset = { w: 100, h: 100, p: 'image.png' };\n * const isImage = isImageAsset(asset); // true\n * ```\n *\n * @public\n */\nexport function isImageAsset(asset: Asset.Value): asset is Asset.Image {\n  return 'w' in asset && 'h' in asset && !('xt' in asset) && 'p' in asset;\n}\n\n/**\n * Checks if an asset is an audio asset.\n *\n * @remarks\n * This function accepts an asset object and determines whether it represents an audio asset.\n * It returns `true` if it's an audio asset, `false` otherwise.\n *\n * @param asset - The asset object to check.\n * @returns `true` if it's an audio asset, `false` otherwise.\n *\n * @example\n * ```typescript\n * const asset = { e: 0, u: 'music/', p: 'audio.mp3' };\n * const isAudio = isAudioAsset(asset); // true\n * ```\n *\n * @public\n */\nexport function isAudioAsset(asset: Asset.Value): asset is Asset.Image {\n  return !('h' in asset) && !('w' in asset) && 'p' in asset && 'e' in asset && 'u' in asset && 'id' in asset;\n}\n\n/**\n * Unzips the .lottie file.\n *\n * @remarks\n * This function accepts a .lottie file as a Uint8Array and an optional filter function to refine the unzipping process.\n * It returns a Promise that resolves with the unzipped data.\n *\n * @param dotLottie - The .lottie data as a Uint8Array.\n * @param filter - The filter function to apply to the files. Defaults to a function that always returns true.\n * @returns A Promise that resolves with the unzipped data.\n * @throws {@link DotLottieError} if the .lottie data is not provided or is invalid.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const unzippedData = await unzipDotLottie(dotLottie);\n * ```\n *\n * @public\n */\nexport async function unzipDotLottie(\n  dotLottie: Uint8Array | undefined,\n  filter: UnzipFileFilter = (): boolean => true,\n): Promise<Unzipped> {\n  if (!(dotLottie instanceof Uint8Array)) {\n    throw new DotLottieError('DotLottie not found', ErrorCodes.INVALID_DOTLOTTIE);\n  }\n\n  const unzipped = await new Promise<Unzipped>((resolve, reject) => {\n    fflateUnzip(dotLottie, { filter }, (err, data) => {\n      if (err) {\n        reject(err);\n      }\n      resolve(data);\n    });\n  });\n\n  return unzipped;\n}\n\n/**\n * Unzips a specific file from a `.lottie` archive.\n *\n * @remarks\n * This function accepts a `.lottie` file as a `Uint8Array`, a path string representing the\n * target file to extract, and an optional filter function to further refine the extraction.\n * It returns a `Promise` that resolves to the unzipped `Uint8Array` of the target file.\n *\n * @param dotLottie - The `.lottie` file content as a `Uint8Array`.\n * @param path - The path of the target file within the `.lottie` archive to extract.\n * @param filter - An optional filter function to apply on the unzipping process.\n *                 Accepts a file object and returns a boolean indicating whether the file should be included.\n * @returns A `Promise` that resolves to the `Uint8Array` of the unzipped target file.\n *\n * @throws {@link DotLottieError} if the input is not a valid `.lottie` file or if the target file is not found.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const targetPath = 'images/image.png';\n * const unzippedFile = await unzipDotLottieFile(dotLottie, targetPath);\n * ```\n *\n * @public\n */\nexport async function unzipDotLottieFile(\n  dotLottie: Uint8Array,\n  path: string,\n  filter?: UnzipFileFilter,\n): Promise<Uint8Array | undefined> {\n  if (!(dotLottie instanceof Uint8Array)) {\n    throw new DotLottieError('DotLottie not found', ErrorCodes.INVALID_DOTLOTTIE);\n  }\n\n  const unzipped = await unzipDotLottie(dotLottie, (file) => file.name === path && (!filter || filter(file)));\n\n  return unzipped[path];\n}\n\n/**\n * Retrieves the manifest data from the given DotLottie object.\n *\n * @remarks\n * This function accepts a DotLottie object as a Uint8Array and extracts the manifest data from it.\n * The manifest contains metadata information about the .lottie file, such as the list of animations, themes, and image assets.\n * It returns a Promise that resolves to the manifest data or `undefined` if the manifest is not found.\n *\n * @param dotLottie - The Uint8Array of DotLottie data.\n * @returns A Promise that resolves with the manifest data or `undefined` if not found.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const manifestData = await getManifest(dotLottie);\n * ```\n *\n * @public\n */\nexport async function getManifest(dotLottie: Uint8Array): Promise<Manifest | undefined> {\n  const manifestFileName = 'manifest.json';\n\n  const unzipped = await unzipDotLottie(dotLottie, (file) => file.name === manifestFileName);\n\n  const unzippedManifest = unzipped[manifestFileName];\n\n  if (typeof unzippedManifest === 'undefined') {\n    return undefined;\n  }\n\n  return JSON.parse(strFromU8(unzippedManifest, false)) as Manifest;\n}\n\n/**\n * Validates the provided DotLottie data.\n *\n * @remarks\n * This function accepts a Uint8Array containing .lottie data and validates its structure and content.\n * It returns a Promise that resolves with an object containing a success boolean and an optional error string.\n *\n * @param dotLottie - The DotLottie data as a Uint8Array.\n * @returns A Promise that resolves with an object containing a success boolean and an optional error string.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const validationResult = await validateDotLottie(dotLottie);\n * ```\n *\n * @public\n */\nexport async function validateDotLottie(dotLottie: Uint8Array): Promise<{ error?: string; success: boolean }> {\n  if (!(dotLottie instanceof Uint8Array)) {\n    return { success: false, error: 'DotLottie not found' };\n  }\n\n  const manifest = await getManifest(dotLottie);\n\n  if (typeof manifest === 'undefined') {\n    return { success: false, error: 'Invalid .lottie file, manifest.json is missing' };\n  }\n\n  const manifestValidationResult = safeParse(ManifestSchema, manifest);\n\n  if (!manifestValidationResult.success) {\n    const error = `Invalid .lottie file, manifest.json structure is invalid, ${JSON.stringify(\n      flatten(manifestValidationResult.error).nested,\n      null,\n      2,\n    )}`;\n\n    return { success: false, error };\n  }\n\n  return { success: true };\n}\n\n/**\n * Loads a .lottie file from an ArrayBuffer.\n *\n * @remarks\n * This function takes an ArrayBuffer containing .lottie data and converts it into a Uint8Array.\n * It validates the data and returns a Promise that resolves with the DotLottie data as a Uint8Array.\n *\n * @param arrayBuffer - The ArrayBuffer containing .lottie data.\n * @returns A Promise that resolves with the DotLottie data as a Uint8Array.\n * @throws {@link DotLottieError} if the data is invalid.\n *\n * @example\n * ```typescript\n * const arrayBuffer = new ArrayBuffer(...);\n * const dotLottie = await loadFromArrayBuffer(arrayBuffer);\n * ```\n *\n * @public\n */\nexport async function loadFromArrayBuffer(arrayBuffer: ArrayBuffer): Promise<Uint8Array> {\n  const dotLottie = new Uint8Array(arrayBuffer);\n\n  const validationResult = await validateDotLottie(dotLottie);\n\n  if (validationResult.error) {\n    throw new DotLottieError(validationResult.error, ErrorCodes.INVALID_DOTLOTTIE);\n  }\n\n  return dotLottie;\n}\n\n/**\n * Loads a .lottie file from a given URL.\n *\n * @remarks\n * This function takes a URL string as input and fetches the .lottie file from the provided URL.\n * It returns a Promise that resolves with the DotLottie data as a Uint8Array.\n *\n * @param src - The URL source of the .lottie file.\n * @returns A Promise that resolves with the DotLottie data as a Uint8Array.\n * @throws {@link DotLottieError} if the URL is invalid or if the content type is incorrect.\n *\n * @example\n * ```typescript\n * const url = 'https://example.com/animation.lottie';\n * const dotLottie = await loadFromURL(url);\n * ```\n *\n * @public\n */\nexport async function loadFromURL(src: string): Promise<Uint8Array> {\n  if (!isValidURL(src)) {\n    throw new DotLottieError('Invalid url provided for .lottie file', ErrorCodes.INVALID_URL);\n  }\n\n  const response = await fetch(src);\n\n  const arrayBuffer = await response.arrayBuffer();\n\n  const contentType = response.headers.get('content-type');\n\n  if (!['application/zip', 'application/octet-stream'].includes(contentType || '')) {\n    throw new DotLottieError(\n      `Invalid content type for .lottie file, expected application/zip or application/octet-stream, received ${contentType}`,\n      ErrorCodes.INVALID_DOTLOTTIE,\n    );\n  }\n\n  const dotLottie = await loadFromArrayBuffer(arrayBuffer);\n\n  return dotLottie;\n}\n\n/**\n * Retrieves an audio from the given DotLottie object by its filename.\n *\n * @remarks\n * This function accepts a DotLottie object as a Uint8Array, the filename of the audio to retrieve, and an optional filter function.\n * It returns a Promise that resolves to the audio data URL or `undefined` if not found.\n *\n * @param dotLottie - The Uint8Array of DotLottie data.\n * @param filename - The filename of the image to get.\n * @param filter - An optional filter function to apply on the unzipping process.\n * @returns A Promise that resolves with the audio data URL or `undefined` if not found.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const filename = 'alarm.mp3';\n * const imageData = await getAudio(dotLottie, filename);\n * ```\n *\n * @public\n */\nexport async function getAudio(\n  dotLottie: Uint8Array,\n  filename: string,\n  filter?: UnzipFileFilter,\n): Promise<string | undefined> {\n  const audioFilename = `audio/${filename}`;\n\n  const unzipped = await unzipDotLottieFile(dotLottie, audioFilename, filter);\n\n  if (typeof unzipped === 'undefined') {\n    return undefined;\n  }\n\n  return dataUrlFromU8(unzipped);\n}\n\n/**\n * Retrieves all audio files from the given DotLottie object.\n *\n * @remarks\n * This function accepts a DotLottie object as a Uint8Array and an optional filter function to further refine the extraction.\n * It returns a Promise that resolves to a record containing the audio data URLs mapped by their ID.\n *\n * @param dotLottie - The Uint8Array of DotLottie data.\n * @param filter - An optional filter function to apply on the unzipping process.\n * @returns A Promise that resolves to a record containing the audio data URLs mapped by their ID.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const allAudio = await getAllAudio(dotLottie);\n * ```\n *\n * @public\n */\nexport async function getAllAudio(dotLottie: Uint8Array, filter?: UnzipFileFilter): Promise<Record<string, string>> {\n  const unzippedAudio = await unzipDotLottie(dotLottie, (file) => {\n    const name = file.name.replace('audio/', '');\n\n    return file.name.startsWith('audio/') && (!filter || filter({ ...file, name }));\n  });\n\n  const audio: Record<string, string> = {};\n\n  for (const audioPath in unzippedAudio) {\n    const unzippedSingleAudio = unzippedAudio[audioPath];\n\n    if (unzippedSingleAudio instanceof Uint8Array) {\n      const audioId = audioPath.replace('audio/', '');\n\n      audio[audioId] = dataUrlFromU8(unzippedSingleAudio);\n    }\n  }\n\n  return audio;\n}\n\n/**\n * Inlines audio assets for the given animations within a DotLottie object.\n *\n * @remarks\n * This function accepts a DotLottie object as a Uint8Array and a record containing the animations to process.\n * It identifies the audio used in the animations and replaces their references with the actual audio data.\n * This operation is performed asynchronously, and the function returns a Promise that resolves when the operation is complete.\n *\n * @param dotLottie - The DotLottie object containing the animations.\n * @param animations - A record containing the animations to process.\n * @returns A Promise that resolves when the operation is complete, returning nothing.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const animations = { animation1: {...}, animation2: {...} };\n * await inlineAudioAssets(dotLottie, animations);\n * ```\n *\n * @public\n */\nexport async function inlineAudioAssets(\n  dotLottie: Uint8Array,\n  animations: Record<string, AnimationData>,\n): Promise<void> {\n  const audioMap = new Map<string, Set<string>>();\n\n  for (const [animationId, animationData] of Object.entries(animations)) {\n    for (const asset of animationData.assets || []) {\n      if (isAudioAsset(asset)) {\n        const audioId = asset.p;\n\n        if (!audioMap.has(audioId)) {\n          audioMap.set(audioId, new Set());\n        }\n        audioMap.get(audioId)?.add(animationId);\n      }\n    }\n  }\n\n  const unzippedAudio = await getAllAudio(dotLottie, (file) => audioMap.has(file.name));\n\n  for (const [audioId, animationIdsSet] of audioMap) {\n    const audioDataURL = unzippedAudio[audioId];\n\n    if (audioDataURL) {\n      for (const animationId of animationIdsSet) {\n        const animationData = animations[animationId];\n\n        for (const asset of animationData?.assets || []) {\n          if (isAudioAsset(asset) && asset.p === audioId) {\n            asset.p = audioDataURL;\n            asset.u = '';\n            asset.e = 1;\n          }\n        }\n      }\n    }\n  }\n}\n\n/**\n * Retrieves an image from the given DotLottie object by its filename.\n *\n * @remarks\n * This function accepts a DotLottie object as a Uint8Array, the filename of the image to retrieve, and an optional filter function.\n * It returns a Promise that resolves to the image data URL or `undefined` if not found.\n *\n * @param dotLottie - The Uint8Array of DotLottie data.\n * @param filename - The filename of the image to get.\n * @param filter - An optional filter function to apply on the unzipping process.\n * @returns A Promise that resolves with the image data URL or `undefined` if not found.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const filename = 'image.png';\n * const imageData = await getImage(dotLottie, filename);\n * ```\n *\n * @public\n */\nexport async function getImage(\n  dotLottie: Uint8Array,\n  filename: string,\n  filter?: UnzipFileFilter,\n): Promise<string | undefined> {\n  const imageFilename = `images/${filename}`;\n\n  const unzipped = await unzipDotLottieFile(dotLottie, imageFilename, filter);\n\n  if (typeof unzipped === 'undefined') {\n    return undefined;\n  }\n\n  return dataUrlFromU8(unzipped);\n}\n\n/**\n * Retrieves all images from the given DotLottie object.\n *\n * @remarks\n * This function accepts a DotLottie object as a Uint8Array and an optional filter function to further refine the extraction.\n * It returns a Promise that resolves to a record containing the image data URLs mapped by their ID.\n *\n * @param dotLottie - The Uint8Array of DotLottie data.\n * @param filter - An optional filter function to apply on the unzipping process.\n * @returns A Promise that resolves to a record containing the image data URLs mapped by their ID.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const images = await getImages(dotLottie);\n * ```\n *\n * @public\n */\nexport async function getImages(dotLottie: Uint8Array, filter?: UnzipFileFilter): Promise<Record<string, string>> {\n  const unzippedImages = await unzipDotLottie(dotLottie, (file) => {\n    const name = file.name.replace('images/', '');\n\n    return file.name.startsWith('images/') && (!filter || filter({ ...file, name }));\n  });\n\n  const images: Record<string, string> = {};\n\n  for (const imagePath in unzippedImages) {\n    const unzippedImage = unzippedImages[imagePath];\n\n    if (unzippedImage instanceof Uint8Array) {\n      const imageId = imagePath.replace('images/', '');\n\n      images[imageId] = dataUrlFromU8(unzippedImage);\n    }\n  }\n\n  return images;\n}\n\n/**\n * Inlines image assets for the given animations within a DotLottie object.\n *\n * @remarks\n * This function accepts a DotLottie object as a Uint8Array and a record containing the animations to process.\n * It identifies the images used in the animations and replaces their references with the actual image data.\n * This operation is performed asynchronously, and the function returns a Promise that resolves when the operation is complete.\n *\n * @param dotLottie - The DotLottie object containing the animations.\n * @param animations - A record containing the animations to process.\n * @returns A Promise that resolves when the operation is complete, returning nothing.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const animations = { animation1: {...}, animation2: {...} };\n * await inlineImageAssets(dotLottie, animations);\n * ```\n *\n * @public\n */\nexport async function inlineImageAssets(\n  dotLottie: Uint8Array,\n  animations: Record<string, AnimationData>,\n): Promise<void> {\n  const imagesMap = new Map<string, Set<string>>();\n\n  for (const [animationId, animationData] of Object.entries(animations)) {\n    for (const asset of animationData.assets || []) {\n      if (isImageAsset(asset)) {\n        const imageId = asset.p;\n\n        if (!imagesMap.has(imageId)) {\n          imagesMap.set(imageId, new Set());\n        }\n        imagesMap.get(imageId)?.add(animationId);\n      }\n    }\n  }\n\n  const unzippedImages = await getImages(dotLottie, (file) => imagesMap.has(file.name));\n\n  for (const [imageId, animationIdsSet] of imagesMap) {\n    const imageDataURL = unzippedImages[imageId];\n\n    if (imageDataURL) {\n      for (const animationId of animationIdsSet) {\n        const animationData = animations[animationId];\n\n        for (const asset of animationData?.assets || []) {\n          if (isImageAsset(asset) && asset.p === imageId) {\n            asset.p = imageDataURL;\n            asset.u = '';\n            asset.e = 1;\n          }\n        }\n      }\n    }\n  }\n}\n\n/**\n * Retrieves an animation from the given DotLottie object by its ID.\n *\n * @remarks\n * This function accepts a DotLottie object as a Uint8Array, the animation ID to retrieve, and an optional inlineAssets option.\n * It returns a Promise that resolves to the animation data or `undefined` if not found.\n *\n * @param dotLottie - The Uint8Array of DotLottie data.\n * @param animationId - The animation ID to get.\n * @param options - An object containing an optional `inlineAssets` boolean to control whether image assets should be inlined.\n * @param filter - An optional function to filter the files to be unzipped.\n * @returns A Promise that resolves with the animation data or `undefined` if not found.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const animationId = 'example';\n * const animationData = await getAnimation(dotLottie, animationId, { inlineAssets: true });\n * ```\n *\n * @public\n */\nexport async function getAnimation(\n  dotLottie: Uint8Array,\n  animationId: string,\n  { inlineAssets }: { inlineAssets?: boolean } = {},\n  filter?: UnzipFileFilter,\n): Promise<AnimationData | undefined> {\n  const animationFilename = `animations/${animationId}.json`;\n\n  const unzippedAnimation = await unzipDotLottieFile(dotLottie, animationFilename, filter);\n\n  if (typeof unzippedAnimation === 'undefined') {\n    return undefined;\n  }\n\n  const animationData = JSON.parse(strFromU8(unzippedAnimation, false)) as AnimationData;\n\n  if (!inlineAssets) {\n    return animationData;\n  }\n\n  const animationsMap = {\n    [animationId]: animationData,\n  };\n\n  await inlineImageAssets(dotLottie, animationsMap);\n\n  await inlineAudioAssets(dotLottie, animationsMap);\n\n  return animationData;\n}\n\n/**\n * Retrieves the animations from the given DotLottie object, with optional filtering and asset inlining.\n *\n * @remarks\n * This function accepts a DotLottie object as a Uint8Array, an optional inlineAssets option, and an optional filter function.\n * It returns a Promise that resolves to a record containing the animation data mapped by their ID.\n *\n * @param dotLottie - The Uint8Array of DotLottie data.\n * @param options - An object containing an optional `inlineAssets` boolean to control whether assets should be inlined.\n * @param filter - An optional function to filter the files to be unzipped.\n * @returns A Promise that resolves to a record containing the animation data mapped by their ID.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const animations = await getAnimations(dotLottie, { inlineAssets: true });\n * ```\n *\n * @public\n */\nexport async function getAnimations(\n  dotLottie: Uint8Array,\n  { inlineAssets }: { inlineAssets?: boolean } = {},\n  filter?: UnzipFileFilter,\n): Promise<Record<string, AnimationData>> {\n  const animationsMap: Record<string, AnimationData> = {};\n  const unzippedAnimations = await unzipDotLottie(dotLottie, (file) => {\n    const filename = file.name.replace('animations/', '').replace('.json', '');\n\n    return file.name.startsWith('animations/') && (!filter || filter({ ...file, name: filename }));\n  });\n\n  for (const animationPath in unzippedAnimations) {\n    const data = unzippedAnimations[animationPath];\n\n    if (data instanceof Uint8Array) {\n      const animationId = animationPath.replace('animations/', '').replace('.json', '');\n      const animationData = JSON.parse(strFromU8(data, false)) as AnimationData;\n\n      animationsMap[animationId] = animationData;\n    }\n  }\n\n  if (!inlineAssets) {\n    return animationsMap;\n  }\n\n  await inlineImageAssets(dotLottie, animationsMap);\n\n  return animationsMap;\n}\n\n/**\n * Retrieves the themes from the given DotLottie object.\n *\n * @remarks\n * This function accepts a DotLottie object as a Uint8Array and an optional filter function to refine the extraction of themes.\n * It returns a Promise that resolves to a record containing the themes mapped by their ID.\n *\n * @param dotLottie - The DotLottie object containing the themes.\n * @param filter - An optional function to filter the files to be unzipped.\n * @returns A Promise that resolves to a record containing the themes mapped by their ID.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const themes = await getThemes(dotLottie);\n * ```\n */\nexport async function getThemes(\n  dotLottie: Uint8Array,\n  filter?: UnzipFileFilter,\n): Promise<Record<string, Record<string, unknown>>> {\n  const themesMap: Record<string, Record<string, unknown>> = {};\n\n  const unzippedThemes = await unzipDotLottie(dotLottie, (file) => {\n    const name = file.name.replace('themes/', '').replace('.json', '');\n\n    return file.name.startsWith('themes/') && (!filter || filter({ ...file, name }));\n  });\n\n  for (const themePath in unzippedThemes) {\n    const data = unzippedThemes[themePath];\n\n    if (data instanceof Uint8Array) {\n      const themeId = themePath.replace('themes/', '').replace('.json', '');\n\n      themesMap[themeId] = JSON.parse(strFromU8(data, false));\n    }\n  }\n\n  return themesMap;\n}\n\n/**\n * Retrieves a specific theme by ID from the given DotLottie object.\n *\n * @remarks\n * This function accepts a DotLottie object as a Uint8Array, the theme ID to retrieve, and an optional filter function.\n * It returns a Promise that resolves to the theme as a string or `undefined` if not found.\n *\n * @param dotLottie - The DotLottie object containing the theme.\n * @param themeId - The ID of the theme to retrieve.\n * @param filter - An optional function to filter the files to be unzipped.\n * @returns A Promise that resolves to the theme as a string or `undefined` if not found.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const themeId = 'dark';\n * const theme = await getTheme(dotLottie, themeId);\n * ```\n */\nexport async function getTheme(\n  dotLottie: Uint8Array,\n  themeId: string,\n  filter?: UnzipFileFilter,\n): Promise<Record<string, unknown> | undefined> {\n  const themeFilename = `themes/${themeId}.json`;\n\n  const unzippedTheme = await unzipDotLottieFile(dotLottie, themeFilename, filter);\n\n  if (typeof unzippedTheme === 'undefined') {\n    return undefined;\n  }\n\n  return JSON.parse(strFromU8(unzippedTheme, false));\n}\n\n/**\n * Retrieves the state machines from the given DotLottie object.\n *\n * @remarks\n * This function accepts a DotLottie object as a Uint8Array and an optional filter function to refine the extraction of state machines.\n * It returns a Promise that resolves to a record containing the state machines mapped by their ID.\n *\n * @param dotLottie - The DotLottie object containing the state machines.\n * @param filter - An optional function to filter the files to be unzipped.\n * @returns A Promise that resolves to a record containing the state machines mapped by their ID.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const machines = await getStateMachines(dotLottie);\n * ```\n */\nexport async function getStateMachines(\n  dotLottie: Uint8Array,\n  filter?: UnzipFileFilter,\n): Promise<Record<string, string>> {\n  const statesMap: Record<string, string> = {};\n\n  const unzippedStates = await unzipDotLottie(dotLottie, (file) => {\n    const name = file.name.replace('states/', '').replace('.json', '');\n\n    return file.name.startsWith('states/') && (!filter || filter({ ...file, name }));\n  });\n\n  for (const statePath in unzippedStates) {\n    const data = unzippedStates[statePath];\n\n    if (data instanceof Uint8Array) {\n      const themeId = statePath.replace('states/', '').replace('.json', '');\n\n      statesMap[themeId] = strFromU8(data, false);\n    }\n  }\n\n  return statesMap;\n}\n\n/**\n * Retrieves a specific state machine by ID from the given DotLottie object.\n *\n * @remarks\n * This function accepts a DotLottie object as a Uint8Array, the state ID to retrieve, and an optional filter function.\n * It returns a Promise that resolves to the state machine as a string or `undefined` if not found.\n *\n * @param dotLottie - The DotLottie object containing the theme.\n * @param stateMachineId - The ID of the state machine to retrieve.\n * @param filter - An optional function to filter the files to be unzipped.\n * @returns A Promise that resolves to the state machine as a string or `undefined` if not found.\n *\n * @example\n * ```typescript\n * const dotLottie = new Uint8Array(...);\n * const stateMachineId = 'walk';\n * const stateMachine = await getState(dotLottie, stateMachineId);\n * ```\n */\nexport async function getStateMachine(\n  dotLottie: Uint8Array,\n  stateMachineId: string,\n  filter?: UnzipFileFilter,\n): Promise<LottieStateMachine | undefined> {\n  const stateMachineFilename = `states/${stateMachineId}.json`;\n\n  const unzippedStateMachine = await unzipDotLottieFile(dotLottie, stateMachineFilename, filter);\n\n  if (typeof unzippedStateMachine === 'undefined') {\n    return undefined;\n  }\n\n  const stateMachine = JSON.parse(strFromU8(unzippedStateMachine, false)) as LottieStateMachine;\n\n  return stateMachine;\n}\n","/**\n * Copyright 2023 Design Barn Inc.\n */\n\nimport type { ZipOptions } from 'fflate';\n\nimport type { LottieAnimationCommon } from './lottie-animation-common';\nimport { dataUrlFromU8, DotLottieError } from './utils';\n\nexport type ImageData = string | ArrayBuffer | Blob;\n\nexport interface ImageOptions {\n  data?: ImageData;\n  fileName: string;\n  id: string;\n  parentAnimations?: LottieAnimationCommon[];\n  zipOptions?: ZipOptions;\n}\n\nexport class LottieImageCommon {\n  protected _data?: ImageData;\n\n  protected _id: string = '';\n\n  protected _fileName: string = '';\n\n  protected _parentAnimations: LottieAnimationCommon[];\n\n  protected _zipOptions: ZipOptions;\n\n  public constructor(options: ImageOptions) {\n    this._requireValidId(options.id);\n    this._requireValidFileName(options.fileName);\n\n    this._zipOptions = options.zipOptions ?? {};\n\n    if (options.data) {\n      this._data = options.data;\n    }\n\n    if (options.id) {\n      this._id = options.id;\n    }\n\n    if (options.fileName) {\n      this._fileName = options.fileName;\n    }\n\n    this._parentAnimations = options.parentAnimations || [];\n  }\n\n  public get zipOptions(): ZipOptions {\n    return this._zipOptions;\n  }\n\n  public set zipOptions(zipOptions: ZipOptions) {\n    this._zipOptions = zipOptions;\n  }\n\n  /**\n   * Ensure that the provided id is a valid string.\n   * The id must be a non-empty string, otherwise an error will be thrown.\n   * @param id - The id to validate.\n   * @throws Error - if the id is not a valid string.\n   */\n  private _requireValidId(id: string | undefined): asserts id is string {\n    if (!id) throw new DotLottieError('Invalid image id');\n  }\n\n  /**\n   * Ensure that the provided fileName is a valid string.\n   * The fileName must be a non-empty string, otherwise an error will be thrown.\n   * @param fileName - The fileName to validate.\n   * @throws Error - if the fileName is not a valid string.\n   */\n  private _requireValidFileName(fileName: string | undefined): asserts fileName is string {\n    if (!fileName) throw new DotLottieError('Invalid image fileName');\n  }\n\n  public get fileName(): string {\n    return this._fileName;\n  }\n\n  public set fileName(fileName: string) {\n    this._requireValidFileName(fileName);\n\n    this._fileName = fileName;\n  }\n\n  public get id(): string {\n    return this._id;\n  }\n\n  public set id(id: string) {\n    this._requireValidId(id);\n\n    this._id = id;\n  }\n\n  public get data(): ImageData | undefined {\n    return this._data;\n  }\n\n  public set data(data: ImageData | undefined) {\n    if (!data) {\n      throw new DotLottieError('Invalid data');\n    }\n\n    this._data = data;\n  }\n\n  public get parentAnimations(): LottieAnimationCommon[] {\n    return this._parentAnimations;\n  }\n\n  public set parentAnimations(parentAnimations: LottieAnimationCommon[]) {\n    this._parentAnimations = parentAnimations;\n  }\n\n  public async toDataURL(): Promise<string> {\n    if (this._data && this._isDataURL(this._data)) return this.data as string;\n\n    const arrayBuffer = await this.toArrayBuffer();\n\n    return dataUrlFromU8(new Uint8Array(arrayBuffer));\n  }\n\n  /**\n   * Renames the id and fileName to newName.\n   * @param newName - A new id and filename for the image.\n   */\n  public renameImage(newName: string): void {\n    this.id = newName;\n\n    if (this.fileName) {\n      let fileExt = this.fileName.split('.').pop();\n\n      if (!fileExt) {\n        fileExt = '.png';\n      }\n      // Default to png if the file extension isn't available\n      this.fileName = `${newName}.${fileExt}`;\n    }\n  }\n\n  public async toArrayBuffer(): Promise<ArrayBuffer> {\n    const blob = await (await this.toBlob()).arrayBuffer();\n\n    return blob;\n  }\n\n  public async toBlob(): Promise<Blob> {\n    if (!this._data) {\n      throw new DotLottieError('Invalid image data.');\n    }\n\n    if (this._isDataURL(this._data)) {\n      const data = this._data as string;\n\n      const [header, base64] = data.split(',');\n\n      // If the data doesnt contain the encoding URL, return it\n      if ((!header || !base64) && data.length) {\n        return new Blob([data]);\n      }\n\n      if (!header || !base64) {\n        throw new DotLottieError('Invalid image data.');\n      }\n\n      // eslint-disable-next-line require-unicode-regexp\n      const type = header.replace('data:', '').replace(/;base64$/, '');\n\n      return new Blob([base64], { type });\n    }\n\n    if (this._isArrayBuffer(this._data)) {\n      return new Blob([this._data]);\n    }\n\n    if (this._isBlob(this._data)) {\n      return this._data as Blob;\n    }\n\n    throw new DotLottieError('Invalid image data.');\n  }\n\n  protected async _fromUrlToBlob(url: string): Promise<Blob> {\n    const response = await fetch(url);\n\n    return response.blob();\n  }\n\n  protected _isArrayBuffer(data: ImageData): boolean {\n    return data instanceof ArrayBuffer;\n  }\n\n  protected _isDataURL(data: ImageData): boolean {\n    return typeof data === 'string' && data.startsWith('data:');\n  }\n\n  protected _isBlob(data: ImageData): boolean {\n    return data instanceof Blob;\n  }\n}\n","/**\n * Copyright 2023 Design Barn Inc.\n */\n\nimport type { DotLottieCommon } from './dotlottie-common';\nimport { createError } from './utils';\n\ninterface DotLottiePluginOptions {\n  parallel?: boolean;\n}\n\nexport class DotLottiePlugin {\n  protected dotlottie: DotLottieCommon | undefined;\n\n  protected _parallel: boolean = false;\n\n  public constructor(options?: DotLottiePluginOptions) {\n    this.dotlottie = undefined;\n\n    if (options?.parallel) {\n      this._parallel = options.parallel;\n    }\n  }\n\n  public install(dotlottie: DotLottieCommon): void {\n    this.dotlottie = dotlottie;\n  }\n\n  public uninstall(): void {\n    this.dotlottie = undefined;\n  }\n\n  public get parallel(): boolean {\n    return this._parallel;\n  }\n\n  public set parallel(value: boolean) {\n    this._parallel = value;\n  }\n\n  public async onBuild(): Promise<void> {\n    throw createError('dotlottie-plugin build Not implemented!');\n  }\n\n  protected _requireDotLottie(dotLottie: DotLottieCommon | undefined): asserts dotLottie {\n    if (!dotLottie) throw createError('dotLottie context is null inside of duplicate image detector plugin.');\n  }\n}\n","/**\n * Copyright 2023 Design Barn Inc.\n */\n\nimport type { ImageOptions } from './common';\nimport { LottieImageCommon } from './common';\n\nexport class LottieImage extends LottieImageCommon {\n  public constructor(options: ImageOptions) {\n    super(options);\n  }\n}\n","/**\n * Copyright 2023 Design Barn Inc.\n */\n\nimport type { Animation as AnimationType } from '@lottiefiles/lottie-types';\n\nimport { LottieImage } from '../lottie-image';\n\nimport { DotLottiePlugin } from './dotlottie-plugin';\nimport type { LottieAnimationCommon } from './lottie-animation-common';\nimport type { LottieImageCommon } from './lottie-image-common';\nimport { createError } from './utils';\n\ninterface LottieImageCompare {\n  excludeFromExport: boolean;\n  hash: string | undefined;\n  image: LottieImageCommon;\n}\n\nexport class DuplicateImageDetectorCommon extends DotLottiePlugin {\n  public async generatePhash(_image: LottieImageCommon): Promise<string> {\n    createError('generatePhash(image: LottieImageCommon): Promise<Hash> is not implemented in concrete class.');\n\n    return '';\n  }\n\n  public distanceTo(_imageHash: string, _targetImageHash: string): number {\n    createError(\n      'distanceTo(_imageHash: string, _targetImageHash: string): Promise<number> is not implemented in concrete class.',\n    );\n\n    return 0;\n  }\n\n  private async _createRecordOfDuplicates(): Promise<Record<string, LottieImageCommon[]>> {\n    this._requireDotLottie(this.dotlottie);\n\n    const images: LottieImageCompare[] = [];\n    const recordOfDuplicates: Record<string, LottieImageCommon[]> = {};\n\n    // push all of the animation image assets in to the images array\n    for (const animation of this.dotlottie.animations) {\n      for (const image of animation.imageAssets) {\n        images.push({\n          excludeFromExport: false,\n          image,\n          hash: await this.generatePhash(image),\n        });\n      }\n    }\n\n    // For every array of images\n    // Loop over the images of the array\n    for (const image of images) {\n      // Now that we have a single image of the image array, compare it to every other image in the arry\n      for (const compareImage of images) {\n        if (\n          image.image.id !== compareImage.image.id &&\n          !image.excludeFromExport &&\n          !compareImage.excludeFromExport &&\n          image.hash &&\n          compareImage.hash &&\n          this.distanceTo(image.hash, compareImage.hash) < 5\n          // image.hash.getHammingDistance(compareImage.hash) < 5\n        ) {\n          // Check if key is already in use\n          if (!recordOfDuplicates[image.image.fileName] && !recordOfDuplicates[compareImage.image.fileName]) {\n            compareImage.excludeFromExport = true;\n\n            recordOfDuplicates[image.image.fileName] = [compareImage.image];\n          } else if (recordOfDuplicates[compareImage.image.fileName]) {\n            // Check for duplicates, otherwise push the duplicate image\n            if (!recordOfDuplicates[compareImage.image.fileName]?.find((item) => item.id === image.image.id)) {\n              image.excludeFromExport = true;\n              recordOfDuplicates[compareImage.image.fileName]?.push(image.image);\n            }\n          }\n        }\n      }\n    }\n\n    return recordOfDuplicates;\n  }\n\n  /**\n   * Apply the image path to all duplicate images.\n   *\n   * @param recordOfDuplicates - A record of duplicate images, the key being a fileName,\n   * the value being the identical LottieImageCommon object.\n   */\n  public adjustDuplicateImageAssetPath(\n    animation: LottieAnimationCommon,\n    recordOfDuplicates: Record<string, LottieImageCommon[]>,\n  ): void {\n    for (const key in recordOfDuplicates) {\n      if (key) {\n        recordOfDuplicates[key]?.forEach((item) => {\n          // Check if this animation has the image before loop over data to save time ?\n\n          if (animation.data) {\n            const animationAssets = animation.data.assets as AnimationType['assets'];\n\n            if (animationAssets) {\n              animationAssets.forEach((asset) => {\n                if ('w' in asset && 'h' in asset) {\n                  // we've found an asset id thats equal to the id of a duplicate image\n                  // Or we found the fileName of a duplicate inside the asset, so we need to change it\n\n                  if (asset.p === item.fileName) {\n                    const fileName = key;\n\n                    asset.p = fileName;\n                  }\n                }\n              });\n            }\n          }\n        });\n      }\n    }\n  }\n\n  public override async onBuild(): Promise<void> {\n    this._requireDotLottie(this.dotlottie);\n\n    // Create a record of duplicates\n    const recordOfDuplicates: Record<string, LottieImageCommon[]> = await this._createRecordOfDuplicates();\n\n    // Check the record of duplicates and repath the duplicate images\n    this.dotlottie.animations.forEach((animation) => {\n      this.adjustDuplicateImageAssetPath(animation, recordOfDuplicates);\n    });\n\n    // Create an array of duplicates by looping over the recordOfDuplicates and using the key as the image to use\n    const clonedImages: Record<string, LottieImage> = {};\n    const images = this.dotlottie.getImages();\n\n    for (const key in recordOfDuplicates) {\n      if (key) {\n        for (const image of images) {\n          if (image.fileName === key && image.data !== undefined) {\n            clonedImages[key] = new LottieImage({\n              data: image.data,\n              id: image.id,\n              fileName: image.fileName,\n            });\n          }\n        }\n      }\n    }\n\n    if (Object.keys(clonedImages).length !== Object.keys(recordOfDuplicates).length)\n      createError('The number of cloned images does not match the number of duplicate keys.');\n\n    // For each image of recordOfDuplicates, remove itself from all the parent animations and push the clone\n    for (const key in recordOfDuplicates) {\n      if (key) {\n        recordOfDuplicates[key]?.forEach((image) => {\n          if (image.parentAnimations.length) {\n            for (const parentAnimation of image.parentAnimations) {\n              parentAnimation.imageAssets.splice(parentAnimation.imageAssets.indexOf(image), 1);\n\n              const clonedImage = clonedImages[key];\n\n              if (clonedImage !== undefined) {\n                parentAnimation.imageAssets.push(clonedImage);\n\n                clonedImage.parentAnimations.push(parentAnimation);\n              }\n            }\n          }\n        });\n      }\n    }\n  }\n}\n","/**\n * Copyright 2023 Design Barn Inc.\n */\n\nimport { Hash, DifferenceHashBuilder } from 'browser-image-hash';\n\nimport { DuplicateImageDetectorCommon } from './common';\nimport type { LottieImageCommon } from './common';\n\nexport class DuplicateImageDetector extends DuplicateImageDetectorCommon {\n  public override async generatePhash(image: LottieImageCommon): Promise<string> {\n    const builder = new DifferenceHashBuilder();\n    const targetURL = new URL(await image.toDataURL());\n\n    const destHash = await builder.build(targetURL);\n\n    return destHash.rawHash;\n  }\n\n  public override distanceTo(imageHash: string, targetImageHash: string): number {\n    const srcHash = new Hash(imageHash);\n    const targetHash = new Hash(targetImageHash);\n\n    return srcHash.getHammingDistance(targetHash);\n  }\n}\n"]}